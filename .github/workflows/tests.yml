name: tests
on:
  push:
  pull_request:
    types: [opened, ready_for_review]
jobs:
  check-PR:
    # Check if there is a PR - allows one main workflow with dependency on previous jobs
    runs-on: ubuntu-latest
    outputs:
      PR_status: ${{ steps.PR.outputs.pr_found }}
      PR: ${{ steps.PR.outputs.pr }}
    steps:
      - name: Check if PR
        uses: 8BitJonny/gh-get-current-pr@2.2.0
        id: PR
        with:
          filterOutClosed: true
          filterOutDraft: true

  integration-tests:
    needs: [check-PR]
    if: |
      (needs.check-PR.outputs.PR_status == 'true') ||
      (github.event_name == 'pull_request' && github.event.pull_request.draft == false) ||
      github.ref == 'refs/heads/master'
    uses: ./.github/workflows/integration_tests.yml
    secrets: inherit
