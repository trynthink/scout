#!/usr/bin/env python3

""" Tests for PartitionMicrosegmentTest """

from scout.ecm_prep import Measure, MeasurePackage, ECMPrepHelper, ECMPrep
from scout.ecm_prep_vars import UsefulVars, UsefulInputFiles
from scout.config import FilePaths as fp
from scout.ecm_prep_args import ecm_args
from pathlib import Path
import pytest
import numpy
import os
import copy
from tests.ecm_prep_test.common import NullOpts, dict_check


@pytest.fixture(scope="module")
def test_data():
    """Fixture providing test data."""
    # Null user options/options dict
    opts, opts_dict = [NullOpts().opts, NullOpts().opts_dict]
    time_horizons = ["2009", "2010", "2011"]
    # Base directory
    base_dir = os.getcwd()
    handyfiles = UsefulInputFiles(opts)
    handyvars = UsefulVars(
        base_dir, handyfiles, opts)
    handyvars.aeo_years = ["2009", "2010", "2011"]
    handyvars.ccosts = numpy.array(
        (b'Test', 1, 4, 1), dtype=[
            ('Category', 'S11'), ('2009', '<f8'),
            ('2010', '<f8'), ('2011', '<f8')])
    sample_measure_fraction = {
        "name": "sample measure 1 partition",
        "active": 1,
        "market_entry_year": None,
        "market_exit_year": None,
        "market_scaling_fractions": None,
        "market_scaling_fractions_source": None,
        "measure_type": "full service",
        "structure_type": ["new", "existing"],
        "climate_zone": ["AIA_CZ1", "AIA_CZ2"],
        "bldg_type": ["single family home"],
        "fuel_type": {
            "primary": ["electricity"],
            "secondary": None},
        "fuel_switch_to": None,
        "end_use": {
            "primary": ["heating", "cooling"],
            "secondary": None},
        "technology": {
            "primary": ["resistance heat", "ASHP", "GSHP", "room AC"],
            "secondary": None},
        "diffusion": {
            "fraction_2006": 0.3,
            "fraction_2050": 1
          },
        "retro_rate": 0.02}
    sample_measure_bass = {
        "name": "sample measure 1 partition",
        "active": 1,
        "market_entry_year": None,
        "market_exit_year": None,
        "market_scaling_fractions": None,
        "market_scaling_fractions_source": None,
        "measure_type": "full service",
        "structure_type": ["new", "existing"],
        "climate_zone": ["AIA_CZ1", "AIA_CZ2"],
        "bldg_type": ["single family home"],
        "fuel_type": {
            "primary": ["electricity"],
            "secondary": None},
        "fuel_switch_to": None,
        "end_use": {
            "primary": ["heating", "cooling"],
            "secondary": None},
        "technology": {
            "primary": ["resistance heat", "ASHP", "GSHP", "room AC"],
            "secondary": None},
        "diffusion": {
            "bass_model_p": 0.001645368,
            "bass_model_q": 1.455182
          },
        "retro_rate": 0.02}
    sample_measure_fraction_string = {
        "name": "sample measure 1 partition",
        "active": 1,
        "market_entry_year": None,
        "market_exit_year": None,
        "market_scaling_fractions": None,
        "market_scaling_fractions_source": None,
        "measure_type": "full service",
        "structure_type": ["new", "existing"],
        "climate_zone": ["AIA_CZ1", "AIA_CZ2"],
        "bldg_type": ["single family home"],
        "fuel_type": {
            "primary": ["electricity"],
            "secondary": None},
        "fuel_switch_to": None,
        "end_use": {
            "primary": ["heating", "cooling"],
            "secondary": None},
        "technology": {
            "primary": ["resistance heat", "ASHP", "GSHP", "room AC"],
            "secondary": None},
        "diffusion": {
            "fraction_2020": '0.3',
            "fraction_2040": '1'
          },
        "retro_rate": 0.02}
    sample_measure_bass_string = {
        "name": "sample measure 1 partition",
        "active": 1,
        "market_entry_year": None,
        "market_exit_year": None,
        "market_scaling_fractions": None,
        "market_scaling_fractions_source": None,
        "measure_type": "full service",
        "structure_type": ["new", "existing"],
        "climate_zone": ["AIA_CZ1", "AIA_CZ2"],
        "bldg_type": ["single family home"],
        "fuel_type": {
            "primary": ["electricity"],
            "secondary": None},
        "fuel_switch_to": None,
        "end_use": {
            "primary": ["heating", "cooling"],
            "secondary": None},
        "technology": {
            "primary": ["resistance heat", "ASHP", "GSHP", "room AC"],
            "secondary": None},
        "diffusion": {
            "bass_model_p": '0.001645368',
            "bass_model_q": '1.455182'
          },
        "retro_rate": 0.02}
    sample_measure_bad_string = {
        "name": "sample measure 1 partition",
        "active": 1,
        "market_entry_year": None,
        "market_exit_year": None,
        "market_scaling_fractions": None,
        "market_scaling_fractions_source": None,
        "measure_type": "full service",
        "structure_type": ["new", "existing"],
        "climate_zone": ["AIA_CZ1", "AIA_CZ2"],
        "bldg_type": ["single family home"],
        "fuel_type": {
            "primary": ["electricity"],
            "secondary": None},
        "fuel_switch_to": None,
        "end_use": {
            "primary": ["heating", "cooling"],
            "secondary": None},
        "technology": {
            "primary": ["resistance heat", "ASHP", "GSHP", "room AC"],
            "secondary": None},
        "diffusion": {
            "bass_model_p": 'aaa',
            "bass_model_q": 'bbb'
          },
        "retro_rate": 0.02}
    sample_measure_bad_values = {
        "name": "sample measure 1 partition",
        "active": 1,
        "market_entry_year": None,
        "market_exit_year": None,
        "market_scaling_fractions": None,
        "market_scaling_fractions_source": None,
        "measure_type": "full service",
        "structure_type": ["new", "existing"],
        "climate_zone": ["AIA_CZ1", "AIA_CZ2"],
        "bldg_type": ["single family home"],
        "fuel_type": {
            "primary": ["electricity"],
            "secondary": None},
        "fuel_switch_to": None,
        "end_use": {
            "primary": ["heating", "cooling"],
            "secondary": None},
        "technology": {
            "primary": ["resistance heat", "ASHP", "GSHP", "room AC"],
            "secondary": None},
        "diffusion": {
            "fraction_2016": -1,
            "fraction_2050": 2
          },
        "retro_rate": 0.02}
    sample_measure_wrong_name = {
        "name": "sample measure 1 partition",
        "active": 1,
        "market_entry_year": None,
        "market_exit_year": None,
        "market_scaling_fractions": None,
        "market_scaling_fractions_source": None,
        "measure_type": "full service",
        "structure_type": ["new", "existing"],
        "climate_zone": ["AIA_CZ1", "AIA_CZ2"],
        "bldg_type": ["single family home"],
        "fuel_type": {
            "primary": ["electricity"],
            "secondary": None},
        "fuel_switch_to": None,
        "end_use": {
            "primary": ["heating", "cooling"],
            "secondary": None},
        "technology": {
            "primary": ["resistance heat", "ASHP", "GSHP", "room AC"],
            "secondary": None},
        "diffusion_": {
            "fraction_2016": 0.3,
            "fraction_2050": 1
          },
        "retro_rate": 0.02}
    measure_instance_fraction = Measure(
        base_dir, handyvars, handyfiles, opts_dict,
        **sample_measure_fraction)
    measure_instance_bass = Measure(
        base_dir, handyvars, handyfiles, opts_dict,
        **sample_measure_bass)
    measure_instance_fraction_string = Measure(
        base_dir, handyvars, handyfiles, opts_dict,
        **sample_measure_fraction_string)
    measure_instance_bass_string = Measure(
        base_dir, handyvars, handyfiles, opts_dict,
        **sample_measure_bass_string)
    measure_instance_bad_string = Measure(
        base_dir, handyvars, handyfiles, opts_dict,
        **sample_measure_bad_string)
    measure_instance_bad_values = Measure(
        base_dir, handyvars, handyfiles, opts_dict,
        **sample_measure_bad_values)
    measure_instance_wrong_name = Measure(
        base_dir, handyvars, handyfiles, opts_dict,
        **sample_measure_wrong_name)
    ok_diffuse_params_in = None
    ok_mskeys_in = [
        ('primary', 'AIA_CZ1', 'single family home',
         'electricity', 'heating', 'supply', 'resistance heat',
         'new'),
        ('primary', 'AIA_CZ1', 'single family home',
         'electricity', 'heating', 'supply', 'resistance heat',
         'existing')]
    ok_mskeys_swtch_in = ""
    ok_bldg_sect_in = ["residential", "residential"]
    ok_sqft_subst_in = [0, 0]
    ok_mkt_scale_frac_in = 1
    ok_new_bldg_constr = {
        "annual new": {"2009": 10, "2010": 0, "2011": 0},
        "total new": {"2009": 10, "2010": 10, "2011": 10}}
    ok_stock_in = {"2009": 100, "2010": 100, "2011": 100}
    ok_energy_scnd_in = {"2009": 10, "2010": 20, "2011": 30}
    ok_energy_in = {"2009": 10, "2010": 20, "2011": 30}
    ok_carb_in = {"2009": 30, "2010": 60, "2011": 90}
    ok_fcarb_in = None

    ok_f_refr_in = None
    ok_base_cost_in = {"2009": 10, "2010": 10, "2011": 10}
    ok_cost_meas_in = {"2009": 20, "2010": 20, "2011": 20}
    ok_cost_energy_base_in, ok_cost_energy_meas_in = \
        (numpy.array((b'Test', 1, 2, 2),
                     dtype=[('Category', 'S11'), ('2009', '<f8'),
                            ('2010', '<f8'), ('2011', '<f8')])
         for n in range(2))
    ok_relperf_in = {"2009": 0.30, "2010": 0.30, "2011": 0.30}
    ok_life_base_in = {"2009": 10, "2010": 10, "2011": 10}
    ok_life_meas_in = 10
    ok_ssconv_base_in, ok_ssconv_meas_in = \
        (numpy.array((b'Test', 1, 1, 1),
                     dtype=[('Category', 'S11'), ('2009', '<f8'),
                            ('2010', '<f8'), ('2011', '<f8')])
         for n in range(2))
    ok_carbint_base_in, ok_carbint_meas_in = \
        (numpy.array((b'Test', 1, 1, 1),
                     dtype=[('Category', 'S11'), ('2009', '<f8'),
                            ('2010', '<f8'), ('2011', '<f8')])
         for n in range(2))
    ok_tsv_scale_fracs_in = {
      "energy": {"baseline": 1, "efficient": 1},
      "cost": {"baseline": 1, "efficient": 1},
      "carbon": {"baseline": 1, "efficient": 1}}
    ok_tsv_shapes_in = None
    ok_out_fraction = [[[{'2009': 34.77272987365723,
                              '2010': 36.36363744735718,
                              '2011': 37.95454502105713},
                             {'2009': 3.4772729873657227,
                              '2010': 7.2727274894714355,
                              '2011': 11.386363506317139},
                             {'2009': 10.431818962097168,
                              '2010': 21.818182468414307,
                              '2011': 34.159090518951416},
                             None, None,
                             {'2009': 34.77272987365723,
                              '2010': 36.36363744735718,
                              '2011': 37.95454502105713},
                             {'2009': 1.0431818962097168,
                              '2010': 2.1818182468414307,
                              '2011': 3.4159090518951416}, None,
                             {'2009': 3.1295456886291504,
                              '2010': 6.545454740524292,
                              '2011': 10.247727155685425},
                             None, None,
                             {'2009': 34.77272987365723,
                              '2010': 36.36363744735718,
                              '2011': 37.95454502105713},
                             {'2009': 3.4772729873657227,
                              '2010': 7.2727274894714355,
                              '2011': 11.386363506317139},
                             {'2009': 10.431818962097168,
                              '2010': 21.818182468414307,
                              '2011': 34.159090518951416},
                             None, None,
                             {'2009': 34.77272987365723,
                              '2010': 36.36363744735718,
                              '2011': 37.95454502105713},
                             {'2009': 1.0431818962097168,
                              '2010': 2.1818182468414307,
                              '2011': 3.4159090518951416},
                             {'2009': 3.1295456886291504,
                              '2010': 6.545454740524292,
                              '2011': 10.247727155685425},
                             None, None,
                             {'2009': 347.72729873657227,
                              '2010': 363.6363744735718,
                              '2011': 379.5454502105713},
                             {'2009': 3.4772729873657227,
                              '2010': 14.545454978942871,
                              '2011': 22.772727012634277},
                             {'2009': 10.431818962097168,
                              '2010': 87.27272987365723,
                              '2011': 34.159090518951416},
                             {'2009': 695.4545974731445,
                              '2010': 727.2727489471436,
                              '2011': 759.0909004211426},
                             {'2009': 1.0431818962097168,
                              '2010': 4.363636493682861,
                              '2011': 6.831818103790283},
                             {'2009': 3.1295456886291504,
                              '2010': 26.181818962097168,
                              '2011': 10.247727155685425},
                             {'2009': 347.72729873657227,
                              '2010': 363.6363744735718,
                              '2011': 379.5454502105713},
                             {'2009': 3.4772729873657227,
                              '2010': 14.545454978942871,
                              '2011': 22.772727012634277},
                             {'2009': 10.431818962097168,
                              '2010': 87.27272987365723,
                              '2011': 34.159090518951416},
                             {'2009': 695.4545974731445,
                              '2010': 727.2727489471436,
                              '2011': 759.0909004211426},
                             {'2009': 1.0431818962097168,
                              '2010': 4.363636493682861,
                              '2011': 6.831818103790283},
                             {'2009': 3.1295456886291504,
                              '2010': 26.181818962097168,
                              '2011': 10.247727155685425},
                             {'2009': 0,
                              '2010': 0,
                              '2011': 0},
                             {'2009': 0,
                              '2010': 0,
                              '2011': 0},
                             {'2009': 0,
                              '2010': 0,
                              '2011': 0},
                             {'2009': 0,
                              '2010': 0,
                              '2011': 0},
                             {'2009': 0,
                              '2010': 0,
                              '2011': 0},
                             {'2009': 0,
                              '2010': 0,
                              '2011': 0},
                             {'2009': 0,
                              '2010': 0,
                              '2011': 0},
                             {'2009': 0.34772729873657227,
                              '2010': 0.3636363744735718,
                              '2011': 0.3795454502105713},
                             1],
                            [{'2009': 34.77272987365723,
                              '2010': 36.36363744735718,
                              '2011': 37.95454502105713},
                             {'2009': 3.4772729873657227,
                              '2010': 7.2727274894714355,
                              '2011': 11.386363506317139},
                             {'2009': 10.431818962097168,
                              '2010': 21.818182468414307,
                              '2011': 34.159090518951416},
                             None, None,
                             {'2009': 34.77272987365723,
                              '2010': 36.36363744735718,
                              '2011': 37.95454502105713},
                             {'2009': 1.0431818962097168,
                              '2010': 2.1818182468414307,
                              '2011': 3.4159090518951416}, None,
                             {'2009': 3.1295456886291504,
                              '2010': 6.545454740524292,
                              '2011': 10.247727155685425},
                             None, None,
                             {'2009': 34.77272987365723,
                              '2010': 36.36363744735718,
                              '2011': 37.95454502105713},
                             {'2009': 3.4772729873657227,
                              '2010': 7.2727274894714355,
                              '2011': 11.386363506317139},
                             {'2009': 10.431818962097168,
                              '2010': 21.818182468414307,
                              '2011': 34.159090518951416},
                             None, None,
                             {'2009': 34.77272987365723,
                              '2010': 36.36363744735718,
                              '2011': 37.95454502105713},
                             {'2009': 1.0431818962097168,
                              '2010': 2.1818182468414307,
                              '2011': 3.4159090518951416},
                             {'2009': 3.1295456886291504,
                              '2010': 6.545454740524292,
                              '2011': 10.247727155685425},
                             None, None,
                             {'2009': 347.72729873657227,
                              '2010': 363.6363744735718,
                              '2011': 379.5454502105713},
                             {'2009': 3.4772729873657227,
                              '2010': 14.545454978942871,
                              '2011': 22.772727012634277},
                             {'2009': 10.431818962097168,
                              '2010': 87.27272987365723,
                              '2011': 34.159090518951416},
                             {'2009': 695.4545974731445,
                              '2010': 727.2727489471436,
                              '2011': 759.0909004211426},
                             {'2009': 1.0431818962097168,
                              '2010': 4.363636493682861,
                              '2011': 6.831818103790283},
                             {'2009': 3.1295456886291504,
                              '2010': 26.181818962097168,
                              '2011': 10.247727155685425},
                             {'2009': 347.72729873657227,
                              '2010': 363.6363744735718,
                              '2011': 379.5454502105713},
                             {'2009': 3.4772729873657227,
                              '2010': 14.545454978942871,
                              '2011': 22.772727012634277},
                             {'2009': 10.431818962097168,
                              '2010': 87.27272987365723,
                              '2011': 34.159090518951416},
                             {'2009': 695.4545974731445,
                              '2010': 727.2727489471436,
                              '2011': 759.0909004211426},
                             {'2009': 1.0431818962097168,
                              '2010': 4.363636493682861,
                              '2011': 6.831818103790283},
                             {'2009': 3.1295456886291504,
                              '2010': 26.181818962097168,
                              '2011': 10.247727155685425},
                             {'2009': 0,
                              '2010': 0,
                              '2011': 0},
                             {'2009': 0,
                              '2010': 0,
                              '2011': 0},
                             {'2009': 0,
                              '2010': 0,
                              '2011': 0},
                             {'2009': 0,
                              '2010': 0,
                              '2011': 0},
                             {'2009': 0,
                              '2010': 0,
                              '2011': 0},
                             {'2009': 0,
                              '2010': 0,
                              '2011': 0},
                             {'2009': 0,
                              '2010': 0,
                              '2011': 0},
                             {'2009': 0.34772729873657227,
                              '2010': 0.3636363744735718,
                              '2011': 0.3795454502105713},
                             1]],
                           [[{'2009': 34.77272987365723,
                              '2010': 36.36363744735718,
                              '2011': 37.95454502105713},
                             {'2009': 3.4772729873657227,
                              '2010': 7.2727274894714355,
                              '2011': 11.386363506317139},
                             {'2009': 10.431818962097168,
                              '2010': 21.818182468414307,
                              '2011': 34.159090518951416},
                             None, None,
                             {'2009': 34.77272987365723,
                              '2010': 34.77272987365723,
                              '2011': 34.77272987365723},
                             {'2009': 1.0431818962097168,
                              '2010': 2.4045453071594234,
                              '2011': 4.084090232849121}, None,
                             {'2009': 3.1295456886291504,
                              '2010': 7.213635921478271,
                              '2011': 12.252270698547363},
                             None, None,
                             {'2009': 34.77272987365723,
                              '2010': 0.0,
                              '2011': 0.0},
                             {'2009': 3.4772729873657227,
                              '2010': 0.0,
                              '2011': 0.0},
                             {'2009': 10.431818962097168,
                              '2010': 0.0,
                              '2011': 0.0},
                             None, None,
                             {'2009': 34.77272987365723,
                              '2010': 0.0,
                              '2011': 0.0},
                             {'2009': 1.0431818962097168,
                              '2010': 0.0,
                              '2011': 0.0},
                             {'2009': 3.1295456886291504,
                              '2010': 0.0,
                              '2011': 0.0},
                             None, None,
                             {'2009': 347.72729873657227,
                              '2010': 347.72729873657227,
                              '2011': 347.72729873657227},
                             {'2009': 3.4772729873657227,
                              '2010': 14.545454978942871,
                              '2011': 22.772727012634277},
                             {'2009': 10.431818962097168,
                              '2010': 87.27272987365723,
                              '2011': 34.159090518951416},
                             {'2009': 695.4545974731445,
                              '2010': 695.4545974731445,
                              '2011': 695.4545974731445},
                             {'2009': 1.0431818962097168,
                              '2010': 4.809090614318847,
                              '2011': 8.168180465698242},
                             {'2009': 3.1295456886291504,
                              '2010': 28.854543685913082,
                              '2011': 12.252270698547363},
                             {'2009': 347.72729873657227,
                              '2010': 0.0,
                              '2011': 0.0},
                             {'2009': 3.4772729873657227,
                              '2010': 0.0,
                              '2011': 0.0},
                             {'2009': 10.431818962097168,
                              '2010': 0.0,
                              '2011': 0.0},
                             {'2009': 695.4545974731445,
                              '2010': 0.0,
                              '2011': 0.0},
                             {'2009': 1.0431818962097168,
                              '2010': 0.0,
                              '2011': 0.0},
                             {'2009': 3.1295456886291504,
                              '2010': 0.0,
                              '2011': 0.0},
                             {'2009': 0,
                              '2010': 0,
                              '2011': 0},
                             {'2009': 0,
                              '2010': 0,
                              '2011': 0},
                             {'2009': 0,
                              '2010': 0,
                              '2011': 0},
                             {'2009': 0,
                              '2010': 0,
                              '2011': 0},
                             {'2009': 0,
                              '2010': 0,
                              '2011': 0},
                             {'2009': 0,
                              '2010': 0,
                              '2011': 0},
                             {'2009': 0,
                              '2010': 0,
                              '2011': 0},
                             {'2009': 0.34772729873657227,
                              '2010': 0.3636363744735718,
                              '2011': 0.3795454502105713},
                             1],
                            [{'2009': 34.77272987365723,
                              '2010': 36.36363744735718,
                              '2011': 37.95454502105713},
                             {'2009': 3.4772729873657227,
                              '2010': 7.2727274894714355,
                              '2011': 11.386363506317139},
                             {'2009': 10.431818962097168,
                              '2010': 21.818182468414307,
                              '2011': 34.159090518951416},
                             None, None,
                             {'2009': 4.172727584838867,
                              '2010': 8.536364078521729,
                              '2011': 13.090909481048584},
                             {'2009': 3.185182056427002,
                              '2010': 6.077636518478393,
                              '2011': 8.637272515296935}, None,
                             {'2009': 9.555546169281007,
                              '2010': 18.23290955543518,
                              '2011': 25.91181754589081},
                             None, None,
                             {'2009': 4.172727584838867,
                              '2010': 4.363636493682861,
                              '2011': 4.5545454025268555},
                             {'2009': 0.41727275848388673,
                              '2010': 0.8727272987365723,
                              '2011': 1.3663636207580567},
                             {'2009': 1.2518182754516602,
                              '2010': 2.618181896209717,
                              '2011': 4.099090862274171},
                             None, None,
                             {'2009': 4.172727584838867,
                              '2010': 4.363636493682861,
                              '2011': 4.5545454025268555},
                             {'2009': 0.12518182754516602,
                              '2010': 0.2618181896209717,
                              '2011': 0.409909086227417},
                             {'2009': 0.3755454826354981,
                              '2010': 0.7854545688629151,
                              '2011': 1.2297272586822512},
                             None, None,
                             {'2009': 41.72727584838867,
                              '2010': 85.36364078521729,
                              '2011': 130.90909481048584},
                             {'2009': 3.4772729873657227,
                              '2010': 14.545454978942871,
                              '2011': 22.772727012634277},
                             {'2009': 10.431818962097168,
                              '2010': 87.27272987365723,
                              '2011': 34.159090518951416},
                             {'2009': 83.45455169677734,
                              '2010': 170.72728157043457,
                              '2011': 261.8181896209717},
                             {'2009': 3.185182056427002,
                              '2010': 12.155273036956785,
                              '2011': 17.27454503059387},
                             {'2009': 9.555546169281007,
                              '2010': 72.93163822174073,
                              '2011': 25.91181754589081},
                             {'2009': 41.72727584838867,
                              '2010': 43.63636493682861,
                              '2011': 45.545454025268555},
                             {'2009': 0.41727275848388673,
                              '2010': 1.7454545974731446,
                              '2011': 2.7327272415161135},
                             {'2009': 1.2518182754516602,
                              '2010': 10.472727584838868,
                              '2011': 4.099090862274171},
                             {'2009': 83.45455169677734,
                              '2010': 87.27272987365723,
                              '2011': 91.09090805053711},
                             {'2009': 0.12518182754516602,
                              '2010': 0.5236363792419434,
                              '2011': 0.819818172454834},
                             {'2009': 0.3755454826354981,
                              '2010': 3.1418182754516604,
                              '2011': 1.2297272586822512},
                             {'2009': 0,
                              '2010': 0,
                              '2011': 0},
                             {'2009': 0,
                              '2010': 0,
                              '2011': 0},
                             {'2009': 0,
                              '2010': 0,
                              '2011': 0},
                             {'2009': 0,
                              '2010': 0,
                              '2011': 0},
                             {'2009': 0,
                              '2010': 0,
                              '2011': 0},
                             {'2009': 0,
                              '2010': 0,
                              '2011': 0},
                             {'2009': 0,
                              '2010': 0,
                              '2011': 0},
                             {'2009': 0.34772729873657227,
                              '2010': 0.3636363744735718,
                              '2011': 0.3795454502105713},
                             1]]]
    ok_out_bass = [[[{'2009': 0.0,
                          '2010': 0.37046322242013996,
                          '2011': 1.9299213234335353},
                         {'2009': 0.0,
                          '2010': 0.074092644484028,
                          '2011': 0.5789763970300605},
                         {'2009': 0.0,
                          '2010': 0.222277933452084,
                          '2011': 1.7369291910901816},
                         None, None,
                         {'2009': 0.0,
                          '2010': 0.37046322242013996,
                          '2011': 1.9299213234335353},
                         {'2009': 0.0,
                          '2010': 0.0222277933452084,
                          '2011': 0.17369291910901816}, None,
                         {'2009': 0.0,
                          '2010': 0.0666833800356252,
                          '2011': 0.5210787573270544},
                         None, None,
                         {'2009': 0.0,
                          '2010': 0.37046322242013996,
                          '2011': 1.9299213234335353},
                         {'2009': 0.0,
                          '2010': 0.074092644484028,
                          '2011': 0.5789763970300605},
                         {'2009': 0.0,
                          '2010': 0.222277933452084,
                          '2011': 1.7369291910901816},
                         None, None,
                         {'2009': 0.0,
                          '2010': 0.37046322242013996,
                          '2011': 1.9299213234335353},
                         {'2009': 0.0,
                          '2010': 0.0222277933452084,
                          '2011': 0.17369291910901816},
                         {'2009': 0.0,
                          '2010': 0.0666833800356252,
                          '2011': 0.5210787573270544},
                         None, None,
                         {'2009': 0.0,
                          '2010': 3.7046322242014,
                          '2011': 19.299213234335355},
                         {'2009': 0.0,
                          '2010': 0.148185288968056,
                          '2011': 1.157952794060121},
                         {'2009': 0.0,
                          '2010': 0.889111733808336,
                          '2011': 1.7369291910901816},
                         {'2009': 0.0,
                          '2010': 7.4092644484028,
                          '2011': 38.59842646867071},
                         {'2009': 0.0,
                          '2010': 0.0444555866904168,
                          '2011': 0.3473858382180363},
                         {'2009': 0.0,
                          '2010': 0.2667335201425008,
                          '2011': 0.5210787573270544},
                         {'2009': 0.0,
                          '2010': 3.7046322242014,
                          '2011': 19.299213234335355},
                         {'2009': 0.0,
                          '2010': 0.148185288968056,
                          '2011': 1.157952794060121},
                         {'2009': 0.0,
                          '2010': 0.889111733808336,
                          '2011': 1.7369291910901816},
                         {'2009': 0.0,
                          '2010': 7.4092644484028,
                          '2011': 38.59842646867071},
                         {'2009': 0.0,
                          '2010': 0.0444555866904168,
                          '2011': 0.3473858382180363},
                         {'2009': 0.0,
                          '2010': 0.2667335201425008,
                          '2011': 0.5210787573270544},
                         {'2009': 0,
                          '2010': 0,
                          '2011': 0},
                         {'2009': 0,
                          '2010': 0,
                          '2011': 0},
                         {'2009': 0,
                          '2010': 0,
                          '2011': 0},
                         {'2009': 0,
                          '2010': 0,
                          '2011': 0},
                         {'2009': 0,
                          '2010': 0,
                          '2011': 0},
                         {'2009': 0,
                          '2010': 0,
                          '2011': 0},
                         {'2009': 0,
                          '2010': 0,
                          '2011': 0},
                         {'2009': 0.0,
                          '2010': 0.0037046322242014,
                          '2011': 0.019299213234335352},
                         1],
                        [{'2009': 0.0,
                          '2010': 0.37046322242013996,
                          '2011': 1.9299213234335353},
                         {'2009': 0.0,
                          '2010': 0.074092644484028,
                          '2011': 0.5789763970300605},
                         {'2009': 0.0,
                          '2010': 0.222277933452084,
                          '2011': 1.7369291910901816},
                         None, None,
                         {'2009': 0.0,
                          '2010': 0.37046322242013996,
                          '2011': 1.9299213234335353},
                         {'2009': 0.0,
                          '2010': 0.0222277933452084,
                          '2011': 0.17369291910901816}, None,
                         {'2009': 0.0,
                          '2010': 0.0666833800356252,
                          '2011': 0.5210787573270544},
                         None, None,
                         {'2009': 0.0,
                          '2010': 0.37046322242013996,
                          '2011': 1.9299213234335353},
                         {'2009': 0.0,
                          '2010': 0.074092644484028,
                          '2011': 0.5789763970300605},
                         {'2009': 0.0,
                          '2010': 0.222277933452084,
                          '2011': 1.7369291910901816},
                         None, None,
                         {'2009': 0.0,
                          '2010': 0.37046322242013996,
                          '2011': 1.9299213234335353},
                         {'2009': 0.0,
                          '2010': 0.0222277933452084,
                          '2011': 0.17369291910901816},
                         {'2009': 0.0,
                          '2010': 0.0666833800356252,
                          '2011': 0.5210787573270544},
                         None, None,
                         {'2009': 0.0,
                          '2010': 3.7046322242014,
                          '2011': 19.299213234335355},
                         {'2009': 0.0,
                          '2010': 0.148185288968056,
                          '2011': 1.157952794060121},
                         {'2009': 0.0,
                          '2010': 0.889111733808336,
                          '2011': 1.7369291910901816},
                         {'2009': 0.0,
                          '2010': 7.4092644484028,
                          '2011': 38.59842646867071},
                         {'2009': 0.0,
                          '2010': 0.0444555866904168,
                          '2011': 0.3473858382180363},
                         {'2009': 0.0,
                          '2010': 0.2667335201425008,
                          '2011': 0.5210787573270544},
                         {'2009': 0.0,
                          '2010': 3.7046322242014,
                          '2011': 19.299213234335355},
                         {'2009': 0.0,
                          '2010': 0.148185288968056,
                          '2011': 1.157952794060121},
                         {'2009': 0.0,
                          '2010': 0.889111733808336,
                          '2011': 1.7369291910901816},
                         {'2009': 0.0,
                          '2010': 7.4092644484028,
                          '2011': 38.59842646867071},
                         {'2009': 0.0,
                          '2010': 0.0444555866904168,
                          '2011': 0.3473858382180363},
                         {'2009': 0.0,
                          '2010': 0.2667335201425008,
                          '2011': 0.5210787573270544},
                         {'2009': 0,
                          '2010': 0,
                          '2011': 0},
                         {'2009': 0,
                          '2010': 0,
                          '2011': 0},
                         {'2009': 0,
                          '2010': 0,
                          '2011': 0},
                         {'2009': 0,
                          '2010': 0,
                          '2011': 0},
                         {'2009': 0,
                          '2010': 0,
                          '2011': 0},
                         {'2009': 0,
                          '2010': 0,
                          '2011': 0},
                         {'2009': 0,
                          '2010': 0,
                          '2011': 0},
                         {'2009': 0.0,
                          '2010': 0.0037046322242014,
                          '2011': 0.019299213234335352},
                         1]],
                       [[{'2009': 0.0,
                          '2010': 0.37046322242013996,
                          '2011': 1.9299213234335353},
                         {'2009': 0.0,
                          '2010': 0.074092644484028,
                          '2011': 0.5789763970300605},
                         {'2009': 0.0,
                          '2010': 0.222277933452084,
                          '2011': 1.7369291910901816},
                         None, None,
                         {'2009': 0.0,
                          '2010': 0.0,
                          '2011': 0.0},
                         {'2009': 0.0,
                          '2010': 0.074092644484028,
                          '2011': 0.5789763970300605}, None,
                         {'2009': 0.0,
                          '2010': 0.222277933452084,
                          '2011': 1.7369291910901816},
                         None, None,
                         {'2009': 0.0,
                          '2010': 0.0,
                          '2011': 0.0},
                         {'2009': 0.0,
                          '2010': 0.0,
                          '2011': 0.0},
                         {'2009': 0.0,
                          '2010': 0.0,
                          '2011': 0.0},
                         None, None,
                         {'2009': 0.0,
                          '2010': 0.0,
                          '2011': 0.0},
                         {'2009': 0.0,
                          '2010': 0.0,
                          '2011': 0.0},
                         {'2009': 0.0,
                          '2010': 0.0,
                          '2011': 0.0},
                         None, None,
                         {'2009': 0.0,
                          '2010': 0.0,
                          '2011': 0.0},
                         {'2009': 0.0,
                          '2010': 0.148185288968056,
                          '2011': 1.157952794060121},
                         {'2009': 0.0,
                          '2010': 0.889111733808336,
                          '2011': 1.7369291910901816},
                         {'2009': 0.0,
                          '2010': 0.0,
                          '2011': 0.0},
                         {'2009': 0.0,
                          '2010': 0.148185288968056,
                          '2011': 1.157952794060121},
                         {'2009': 0.0,
                          '2010': 0.889111733808336,
                          '2011': 1.7369291910901816},
                         {'2009': 0.0,
                          '2010': 0.0,
                          '2011': 0.0},
                         {'2009': 0.0,
                          '2010': 0.0,
                          '2011': 0.0},
                         {'2009': 0.0,
                          '2010': 0.0,
                          '2011': 0.0},
                         {'2009': 0.0,
                          '2010': 0.0,
                          '2011': 0.0},
                         {'2009': 0.0,
                          '2010': 0.0,
                          '2011': 0.0},
                         {'2009': 0.0,
                          '2010': 0.0,
                          '2011': 0.0},
                         {'2009': 0,
                          '2010': 0,
                          '2011': 0},
                         {'2009': 0,
                          '2010': 0,
                          '2011': 0},
                         {'2009': 0,
                          '2010': 0,
                          '2011': 0},
                         {'2009': 0,
                          '2010': 0,
                          '2011': 0},
                         {'2009': 0,
                          '2010': 0,
                          '2011': 0},
                         {'2009': 0,
                          '2010': 0,
                          '2011': 0},
                         {'2009': 0,
                          '2010': 0,
                          '2011': 0},
                         {'2009': 0.0,
                          '2010': 0.0037046322242014,
                          '2011': 0.019299213234335352},
                         1],
                        [{'2009': 0.0,
                          '2010': 0.37046322242013996,
                          '2011': 1.9299213234335353},
                         {'2009': 0.0,
                          '2010': 0.074092644484028,
                          '2011': 0.5789763970300605},
                         {'2009': 0.0,
                          '2010': 0.222277933452084,
                          '2011': 1.7369291910901816},
                         None, None,
                         {'2009': 0.0,
                          '2010': 0.0444555866904168,
                          '2011': 0.27604614550244105},
                         {'2009': 0.0,
                          '2010': 0.06786886234736965,
                          '2011': 0.5210067064745479}, None,
                         {'2009': 0.0,
                          '2010': 0.20360658704210893,
                          '2011': 1.563020119423644},
                         None, None,
                         {'2009': 0.0,
                          '2010': 0.0444555866904168,
                          '2011': 0.23159055881202426},
                         {'2009': 0.0,
                          '2010': 0.00889111733808336,
                          '2011': 0.06947716764360727},
                         {'2009': 0.0,
                          '2010': 0.02667335201425008,
                          '2011': 0.2084315029308218},
                         None, None,
                         {'2009': 0.0,
                          '2010': 0.0444555866904168,
                          '2011': 0.23159055881202426},
                         {'2009': 0.0,
                          '2010': 0.002667335201425008,
                          '2011': 0.02084315029308218},
                         {'2009': 0.0,
                          '2010': 0.008002005604275024,
                          '2011': 0.06252945087924654},
                         None, None,
                         {'2009': 0.0,
                          '2010': 0.444555866904168,
                          '2011': 2.7604614550244104},
                         {'2009': 0.0,
                          '2010': 0.148185288968056,
                          '2011': 1.157952794060121},
                         {'2009': 0.0,
                          '2010': 0.889111733808336,
                          '2011': 1.7369291910901816},
                         {'2009': 0.0,
                          '2010': 0.889111733808336,
                          '2011': 5.520922910048821},
                         {'2009': 0.0,
                          '2010': 0.1357377246947393,
                          '2011': 1.0420134129490959},
                         {'2009': 0.0,
                          '2010': 0.8144263481684357,
                          '2011': 1.563020119423644},
                         {'2009': 0.0,
                          '2010': 0.444555866904168,
                          '2011': 2.3159055881202426},
                         {'2009': 0.0,
                          '2010': 0.01778223467616672,
                          '2011': 0.13895433528721454},
                         {'2009': 0.0,
                          '2010': 0.10669340805700032,
                          '2011': 0.2084315029308218},
                         {'2009': 0.0,
                          '2010': 0.889111733808336,
                          '2011': 4.631811176240485},
                         {'2009': 0.0,
                          '2010': 0.005334670402850016,
                          '2011': 0.04168630058616436},
                         {'2009': 0.0,
                          '2010': 0.032008022417100095,
                          '2011': 0.06252945087924654},
                         {'2009': 0,
                          '2010': 0,
                          '2011': 0},
                         {'2009': 0,
                          '2010': 0,
                          '2011': 0},
                         {'2009': 0,
                          '2010': 0,
                          '2011': 0},
                         {'2009': 0,
                          '2010': 0,
                          '2011': 0},
                         {'2009': 0,
                          '2010': 0,
                          '2011': 0},
                         {'2009': 0,
                          '2010': 0,
                          '2011': 0},
                         {'2009': 0,
                          '2010': 0,
                          '2011': 0},
                         {'2009': 0.0,
                          '2010': 0.0037046322242014,
                          '2011': 0.019299213234335352},
                         1]]]
    ok_out_fraction_string = [[[{'2009': 30.000001192092896,
                                     '2010': 30.000001192092896,
                                     '2011': 30.000001192092896},
                                    {'2009': 3.0000001192092896,
                                     '2010': 6.000000238418579,
                                     '2011': 9.000000357627869},
                                    {'2009': 9.000000357627869,
                                     '2010': 18.000000715255737,
                                     '2011': 27.000001072883606},
                                    None, None,
                                    {'2009': 30.000001192092896,
                                     '2010': 30.000001192092896,
                                     '2011': 30.000001192092896},
                                    {'2009': 0.9000000357627869,
                                     '2010': 1.8000000715255737,
                                     '2011': 2.7000001072883606}, None,
                                    {'2009': 2.7000001072883606,
                                     '2010': 5.400000214576721,
                                     '2011': 8.100000321865082},
                                    None, None,
                                    {'2009': 30.000001192092896,
                                     '2010': 30.000001192092896,
                                     '2011': 30.000001192092896},
                                    {'2009': 3.0000001192092896,
                                     '2010': 6.000000238418579,
                                     '2011': 9.000000357627869},
                                    {'2009': 9.000000357627869,
                                     '2010': 18.000000715255737,
                                     '2011': 27.000001072883606},
                                    None, None,
                                    {'2009': 30.000001192092896,
                                     '2010': 30.000001192092896,
                                     '2011': 30.000001192092896},
                                    {'2009': 0.9000000357627869,
                                     '2010': 1.8000000715255737,
                                     '2011': 2.7000001072883606},
                                    {'2009': 2.7000001072883606,
                                     '2010': 5.400000214576721,
                                     '2011': 8.100000321865082},
                                    None, None,
                                    {'2009': 300.00001192092896,
                                     '2010': 300.00001192092896,
                                     '2011': 300.00001192092896},
                                    {'2009': 3.0000001192092896,
                                     '2010': 12.000000476837158,
                                     '2011': 18.000000715255737},
                                    {'2009': 9.000000357627869,
                                     '2010': 72.00000286102295,
                                     '2011': 27.000001072883606},
                                    {'2009': 600.0000238418579,
                                     '2010': 600.0000238418579,
                                     '2011': 600.0000238418579},
                                    {'2009': 0.9000000357627869,
                                     '2010': 3.6000001430511475,
                                     '2011': 5.400000214576721},
                                    {'2009': 2.7000001072883606,
                                     '2010': 21.600000858306885,
                                     '2011': 8.100000321865082},
                                    {'2009': 300.00001192092896,
                                     '2010': 300.00001192092896,
                                     '2011': 300.00001192092896},
                                    {'2009': 3.0000001192092896,
                                     '2010': 12.000000476837158,
                                     '2011': 18.000000715255737},
                                    {'2009': 9.000000357627869,
                                     '2010': 72.00000286102295,
                                     '2011': 27.000001072883606},
                                    {'2009': 600.0000238418579,
                                     '2010': 600.0000238418579,
                                     '2011': 600.0000238418579},
                                    {'2009': 0.9000000357627869,
                                     '2010': 3.6000001430511475,
                                     '2011': 5.400000214576721},
                                    {'2009': 2.7000001072883606,
                                     '2010': 21.600000858306885,
                                     '2011': 8.100000321865082},
                                    {'2009': 0,
                                     '2010': 0,
                                     '2011': 0},
                                    {'2009': 0,
                                     '2010': 0,
                                     '2011': 0},
                                    {'2009': 0,
                                     '2010': 0,
                                     '2011': 0},
                                    {'2009': 0,
                                     '2010': 0,
                                     '2011': 0},
                                    {'2009': 0,
                                     '2010': 0,
                                     '2011': 0},
                                    {'2009': 0,
                                     '2010': 0,
                                     '2011': 0},
                                    {'2009': 0,
                                     '2010': 0,
                                     '2011': 0},
                                    {'2009': 0.30000001192092896,
                                     '2010': 0.30000001192092896,
                                     '2011': 0.30000001192092896},
                                    1],
                                   [{'2009': 30.000001192092896,
                                     '2010': 30.000001192092896,
                                     '2011': 30.000001192092896},
                                    {'2009': 3.0000001192092896,
                                     '2010': 6.000000238418579,
                                     '2011': 9.000000357627869},
                                    {'2009': 9.000000357627869,
                                     '2010': 18.000000715255737,
                                     '2011': 27.000001072883606},
                                    None, None,
                                    {'2009': 30.000001192092896,
                                     '2010': 30.000001192092896,
                                     '2011': 30.000001192092896},
                                    {'2009': 0.9000000357627869,
                                     '2010': 1.8000000715255737,
                                     '2011': 2.7000001072883606}, None,
                                    {'2009': 2.7000001072883606,
                                     '2010': 5.400000214576721,
                                     '2011': 8.100000321865082},
                                    None, None,
                                    {'2009': 30.000001192092896,
                                     '2010': 30.000001192092896,
                                     '2011': 30.000001192092896},
                                    {'2009': 3.0000001192092896,
                                     '2010': 6.000000238418579,
                                     '2011': 9.000000357627869},
                                    {'2009': 9.000000357627869,
                                     '2010': 18.000000715255737,
                                     '2011': 27.000001072883606},
                                    None, None,
                                    {'2009': 30.000001192092896,
                                     '2010': 30.000001192092896,
                                     '2011': 30.000001192092896},
                                    {'2009': 0.9000000357627869,
                                     '2010': 1.8000000715255737,
                                     '2011': 2.7000001072883606},
                                    {'2009': 2.7000001072883606,
                                     '2010': 5.400000214576721,
                                     '2011': 8.100000321865082},
                                    None, None,
                                    {'2009': 300.00001192092896,
                                     '2010': 300.00001192092896,
                                     '2011': 300.00001192092896},
                                    {'2009': 3.0000001192092896,
                                     '2010': 12.000000476837158,
                                     '2011': 18.000000715255737},
                                    {'2009': 9.000000357627869,
                                     '2010': 72.00000286102295,
                                     '2011': 27.000001072883606},
                                    {'2009': 600.0000238418579,
                                     '2010': 600.0000238418579,
                                     '2011': 600.0000238418579},
                                    {'2009': 0.9000000357627869,
                                     '2010': 3.6000001430511475,
                                     '2011': 5.400000214576721},
                                    {'2009': 2.7000001072883606,
                                     '2010': 21.600000858306885,
                                     '2011': 8.100000321865082},
                                    {'2009': 300.00001192092896,
                                     '2010': 300.00001192092896,
                                     '2011': 300.00001192092896},
                                    {'2009': 3.0000001192092896,
                                     '2010': 12.000000476837158,
                                     '2011': 18.000000715255737},
                                    {'2009': 9.000000357627869,
                                     '2010': 72.00000286102295,
                                     '2011': 27.000001072883606},
                                    {'2009': 600.0000238418579,
                                     '2010': 600.0000238418579,
                                     '2011': 600.0000238418579},
                                    {'2009': 0.9000000357627869,
                                     '2010': 3.6000001430511475,
                                     '2011': 5.400000214576721},
                                    {'2009': 2.7000001072883606,
                                     '2010': 21.600000858306885,
                                     '2011': 8.100000321865082},
                                    {'2009': 0,
                                     '2010': 0,
                                     '2011': 0},
                                    {'2009': 0,
                                     '2010': 0,
                                     '2011': 0},
                                    {'2009': 0,
                                     '2010': 0,
                                     '2011': 0},
                                    {'2009': 0,
                                     '2010': 0,
                                     '2011': 0},
                                    {'2009': 0,
                                     '2010': 0,
                                     '2011': 0},
                                    {'2009': 0,
                                     '2010': 0,
                                     '2011': 0},
                                    {'2009': 0,
                                     '2010': 0,
                                     '2011': 0},
                                    {'2009': 0.30000001192092896,
                                     '2010': 0.30000001192092896,
                                     '2011': 0.30000001192092896},
                                    1]],
                                  [[{'2009': 30.000001192092896,
                                     '2010': 30.000001192092896,
                                     '2011': 30.000001192092896},
                                    {'2009': 3.0000001192092896,
                                     '2010': 6.000000238418579,
                                     '2011': 9.000000357627869},
                                    {'2009': 9.000000357627869,
                                     '2010': 18.000000715255737,
                                     '2011': 27.000001072883606},
                                    None, None,
                                    {'2009': 30.000001192092896,
                                     '2010': 30.000001192092896,
                                     '2011': 30.000001192092896},
                                    {'2009': 0.9000000357627869,
                                     '2010': 1.8000000715255737,
                                     '2011': 2.7000001072883606}, None,
                                    {'2009': 2.7000001072883606,
                                     '2010': 5.400000214576721,
                                     '2011': 8.100000321865082},
                                    None, None,
                                    {'2009': 30.000001192092896,
                                     '2010': 0.0,
                                     '2011': 0.0},
                                    {'2009': 3.0000001192092896,
                                     '2010': 0.0,
                                     '2011': 0.0},
                                    {'2009': 9.000000357627869,
                                     '2010': 0.0,
                                     '2011': 0.0},
                                    None, None,
                                    {'2009': 30.000001192092896,
                                     '2010': 0.0,
                                     '2011': 0.0},
                                    {'2009': 0.9000000357627869,
                                     '2010': 0.0,
                                     '2011': 0.0},
                                    {'2009': 2.7000001072883606,
                                     '2010': 0.0,
                                     '2011': 0.0},
                                    None, None,
                                    {'2009': 300.00001192092896,
                                     '2010': 300.00001192092896,
                                     '2011': 300.00001192092896},
                                    {'2009': 3.0000001192092896,
                                     '2010': 12.000000476837158,
                                     '2011': 18.000000715255737},
                                    {'2009': 9.000000357627869,
                                     '2010': 72.00000286102295,
                                     '2011': 27.000001072883606},
                                    {'2009': 600.0000238418579,
                                     '2010': 600.0000238418579,
                                     '2011': 600.0000238418579},
                                    {'2009': 0.9000000357627869,
                                     '2010': 3.6000001430511475,
                                     '2011': 5.400000214576721},
                                    {'2009': 2.7000001072883606,
                                     '2010': 21.600000858306885,
                                     '2011': 8.100000321865082},
                                    {'2009': 300.00001192092896,
                                     '2010': 0.0,
                                     '2011': 0.0},
                                    {'2009': 3.0000001192092896,
                                     '2010': 0.0,
                                     '2011': 0.0},
                                    {'2009': 9.000000357627869,
                                     '2010': 0.0,
                                     '2011': 0.0},
                                    {'2009': 600.0000238418579,
                                     '2010': 0.0,
                                     '2011': 0.0},
                                    {'2009': 0.9000000357627869,
                                     '2010': 0.0,
                                     '2011': 0.0},
                                    {'2009': 2.7000001072883606,
                                     '2010': 0.0,
                                     '2011': 0.0},
                                    {'2009': 0,
                                     '2010': 0,
                                     '2011': 0},
                                    {'2009': 0,
                                     '2010': 0,
                                     '2011': 0},
                                    {'2009': 0,
                                     '2010': 0,
                                     '2011': 0},
                                    {'2009': 0,
                                     '2010': 0,
                                     '2011': 0},
                                    {'2009': 0,
                                     '2010': 0,
                                     '2011': 0},
                                    {'2009': 0,
                                     '2010': 0,
                                     '2011': 0},
                                    {'2009': 0,
                                     '2010': 0,
                                     '2011': 0},
                                    {'2009': 0.30000001192092896,
                                     '2010': 0.30000001192092896,
                                     '2011': 0.30000001192092896},
                                    1],
                                   [{'2009': 30.000001192092896,
                                     '2010': 30.000001192092896,
                                     '2011': 30.000001192092896},
                                    {'2009': 3.0000001192092896,
                                     '2010': 6.000000238418579,
                                     '2011': 9.000000357627869},
                                    {'2009': 9.000000357627869,
                                     '2010': 18.000000715255737,
                                     '2011': 27.000001072883606},
                                    None, None,
                                    {'2009': 3.600000143051148,
                                     '2010': 7.200000286102296,
                                     '2011': 10.800000429153444},
                                    {'2009': 2.748000109195709,
                                     '2010': 4.9920001983642575,
                                     '2011': 6.732000267505645}, None,
                                    {'2009': 8.244000327587127,
                                     '2010': 14.976000595092774,
                                     '2011': 20.196000802516938},
                                    None, None,
                                    {'2009': 3.600000143051148,
                                     '2010': 3.600000143051148,
                                     '2011': 3.600000143051148},
                                    {'2009': 0.3600000143051148,
                                     '2010': 0.7200000286102296,
                                     '2011': 1.0800000429153442},
                                    {'2009': 1.0800000429153442,
                                     '2010': 2.1600000858306885,
                                     '2011': 3.240000128746033},
                                    None, None,
                                    {'2009': 3.600000143051148,
                                     '2010': 3.600000143051148,
                                     '2011': 3.600000143051148},
                                    {'2009': 0.10800000429153443,
                                     '2010': 0.21600000858306886,
                                     '2011': 0.3240000128746033},
                                    {'2009': 0.3240000128746033,
                                     '2010': 0.6480000257492066,
                                     '2011': 0.9720000386238099},
                                    None, None,
                                    {'2009': 36.00000143051148,
                                     '2010': 72.00000286102296,
                                     '2011': 108.00000429153444},
                                    {'2009': 3.0000001192092896,
                                     '2010': 12.000000476837158,
                                     '2011': 18.000000715255737},
                                    {'2009': 9.000000357627869,
                                     '2010': 72.00000286102295,
                                     '2011': 27.000001072883606},
                                    {'2009': 72.00000286102296,
                                     '2010': 144.00000572204593,
                                     '2011': 216.00000858306888},
                                    {'2009': 2.748000109195709,
                                     '2010': 9.984000396728515,
                                     '2011': 13.46400053501129},
                                    {'2009': 8.244000327587127,
                                     '2010': 59.9040023803711,
                                     '2011': 20.196000802516938},
                                    {'2009': 36.00000143051148,
                                     '2010': 36.00000143051148,
                                     '2011': 36.00000143051148},
                                    {'2009': 0.3600000143051148,
                                     '2010': 1.4400000572204592,
                                     '2011': 2.1600000858306885},
                                    {'2009': 1.0800000429153442,
                                     '2010': 8.640000343322754,
                                     '2011': 3.240000128746033},
                                    {'2009': 72.00000286102296,
                                     '2010': 72.00000286102296,
                                     '2011': 72.00000286102296},
                                    {'2009': 0.10800000429153443,
                                     '2010': 0.43200001716613773,
                                     '2011': 0.6480000257492066},
                                    {'2009': 0.3240000128746033,
                                     '2010': 2.5920001029968263,
                                     '2011': 0.9720000386238099},
                                    {'2009': 0,
                                     '2010': 0,
                                     '2011': 0},
                                    {'2009': 0,
                                     '2010': 0,
                                     '2011': 0},
                                    {'2009': 0,
                                     '2010': 0,
                                     '2011': 0},
                                    {'2009': 0,
                                     '2010': 0,
                                     '2011': 0},
                                    {'2009': 0,
                                     '2010': 0,
                                     '2011': 0},
                                    {'2009': 0,
                                     '2010': 0,
                                     '2011': 0},
                                    {'2009': 0,
                                     '2010': 0,
                                     '2011': 0},
                                    {'2009': 0.30000001192092896,
                                     '2010': 0.30000001192092896,
                                     '2011': 0.30000001192092896},
                                    1]]]
    ok_out_bass_string = [[[{'2009': 0.0,
                                 '2010': 0.37046322242013996,
                                 '2011': 1.9299213234335353},
                                {'2009': 0.0,
                                 '2010': 0.074092644484028,
                                 '2011': 0.5789763970300605},
                                {'2009': 0.0,
                                 '2010': 0.222277933452084,
                                 '2011': 1.7369291910901816},
                                None, None,
                                {'2009': 0.0,
                                 '2010': 0.37046322242013996,
                                 '2011': 1.9299213234335353},
                                {'2009': 0.0,
                                 '2010': 0.0222277933452084,
                                 '2011': 0.17369291910901816}, None,
                                {'2009': 0.0,
                                 '2010': 0.0666833800356252,
                                 '2011': 0.5210787573270544},
                                None, None,
                                {'2009': 0.0,
                                 '2010': 0.37046322242013996,
                                 '2011': 1.9299213234335353},
                                {'2009': 0.0,
                                 '2010': 0.074092644484028,
                                 '2011': 0.5789763970300605},
                                {'2009': 0.0,
                                 '2010': 0.222277933452084,
                                 '2011': 1.7369291910901816},
                                None, None,
                                {'2009': 0.0,
                                 '2010': 0.37046322242013996,
                                 '2011': 1.9299213234335353},
                                {'2009': 0.0,
                                 '2010': 0.0222277933452084,
                                 '2011': 0.17369291910901816},
                                {'2009': 0.0,
                                 '2010': 0.0666833800356252,
                                 '2011': 0.5210787573270544},
                                None, None,
                                {'2009': 0.0,
                                 '2010': 3.7046322242014,
                                 '2011': 19.299213234335355},
                                {'2009': 0.0,
                                 '2010': 0.148185288968056,
                                 '2011': 1.157952794060121},
                                {'2009': 0.0,
                                 '2010': 0.889111733808336,
                                 '2011': 1.7369291910901816},
                                {'2009': 0.0,
                                 '2010': 7.4092644484028,
                                 '2011': 38.59842646867071},
                                {'2009': 0.0,
                                 '2010': 0.0444555866904168,
                                 '2011': 0.3473858382180363},
                                {'2009': 0.0,
                                 '2010': 0.2667335201425008,
                                 '2011': 0.5210787573270544},
                                {'2009': 0.0,
                                 '2010': 3.7046322242014,
                                 '2011': 19.299213234335355},
                                {'2009': 0.0,
                                 '2010': 0.148185288968056,
                                 '2011': 1.157952794060121},
                                {'2009': 0.0,
                                 '2010': 0.889111733808336,
                                 '2011': 1.7369291910901816},
                                {'2009': 0.0,
                                 '2010': 7.4092644484028,
                                 '2011': 38.59842646867071},
                                {'2009': 0.0,
                                 '2010': 0.0444555866904168,
                                 '2011': 0.3473858382180363},
                                {'2009': 0.0,
                                 '2010': 0.2667335201425008,
                                 '2011': 0.5210787573270544},
                                {'2009': 0,
                                 '2010': 0,
                                 '2011': 0},
                                {'2009': 0,
                                 '2010': 0,
                                 '2011': 0},
                                {'2009': 0,
                                 '2010': 0,
                                 '2011': 0},
                                {'2009': 0,
                                 '2010': 0,
                                 '2011': 0},
                                {'2009': 0,
                                 '2010': 0,
                                 '2011': 0},
                                {'2009': 0,
                                 '2010': 0,
                                 '2011': 0},
                                {'2009': 0,
                                 '2010': 0,
                                 '2011': 0},
                                {'2009': 0.0,
                                 '2010': 0.0037046322242014,
                                 '2011': 0.019299213234335352},
                                1],
                               [{'2009': 0.0,
                                 '2010': 0.37046322242013996,
                                 '2011': 1.9299213234335353},
                                {'2009': 0.0,
                                 '2010': 0.074092644484028,
                                 '2011': 0.5789763970300605},
                                {'2009': 0.0,
                                 '2010': 0.222277933452084,
                                 '2011': 1.7369291910901816},
                                None, None,
                                {'2009': 0.0,
                                 '2010': 0.37046322242013996,
                                 '2011': 1.9299213234335353},
                                {'2009': 0.0,
                                 '2010': 0.0222277933452084,
                                 '2011': 0.17369291910901816}, None,
                                {'2009': 0.0,
                                 '2010': 0.0666833800356252,
                                 '2011': 0.5210787573270544},
                                None, None,
                                {'2009': 0.0,
                                 '2010': 0.37046322242013996,
                                 '2011': 1.9299213234335353},
                                {'2009': 0.0,
                                 '2010': 0.074092644484028,
                                 '2011': 0.5789763970300605},
                                {'2009': 0.0,
                                 '2010': 0.222277933452084,
                                 '2011': 1.7369291910901816},
                                None, None,
                                {'2009': 0.0,
                                 '2010': 0.37046322242013996,
                                 '2011': 1.9299213234335353},
                                {'2009': 0.0,
                                 '2010': 0.0222277933452084,
                                 '2011': 0.17369291910901816},
                                {'2009': 0.0,
                                 '2010': 0.0666833800356252,
                                 '2011': 0.5210787573270544},
                                None, None,
                                {'2009': 0.0,
                                 '2010': 3.7046322242014,
                                 '2011': 19.299213234335355},
                                {'2009': 0.0,
                                 '2010': 0.148185288968056,
                                 '2011': 1.157952794060121},
                                {'2009': 0.0,
                                 '2010': 0.889111733808336,
                                 '2011': 1.7369291910901816},
                                {'2009': 0.0,
                                 '2010': 7.4092644484028,
                                 '2011': 38.59842646867071},
                                {'2009': 0.0,
                                 '2010': 0.0444555866904168,
                                 '2011': 0.3473858382180363},
                                {'2009': 0.0,
                                 '2010': 0.2667335201425008,
                                 '2011': 0.5210787573270544},
                                {'2009': 0.0,
                                 '2010': 3.7046322242014,
                                 '2011': 19.299213234335355},
                                {'2009': 0.0,
                                 '2010': 0.148185288968056,
                                 '2011': 1.157952794060121},
                                {'2009': 0.0,
                                 '2010': 0.889111733808336,
                                 '2011': 1.7369291910901816},
                                {'2009': 0.0,
                                 '2010': 7.4092644484028,
                                 '2011': 38.59842646867071},
                                {'2009': 0.0,
                                 '2010': 0.0444555866904168,
                                 '2011': 0.3473858382180363},
                                {'2009': 0.0,
                                 '2010': 0.2667335201425008,
                                 '2011': 0.5210787573270544},
                                {'2009': 0,
                                 '2010': 0,
                                 '2011': 0},
                                {'2009': 0,
                                 '2010': 0,
                                 '2011': 0},
                                {'2009': 0,
                                 '2010': 0,
                                 '2011': 0},
                                {'2009': 0,
                                 '2010': 0,
                                 '2011': 0},
                                {'2009': 0,
                                 '2010': 0,
                                 '2011': 0},
                                {'2009': 0,
                                 '2010': 0,
                                 '2011': 0},
                                {'2009': 0,
                                 '2010': 0,
                                 '2011': 0},
                                {'2009': 0.0,
                                 '2010': 0.0037046322242014,
                                 '2011': 0.019299213234335352},
                                1]],
                              [[{'2009': 0.0,
                                 '2010': 0.37046322242013996,
                                 '2011': 1.9299213234335353},
                                {'2009': 0.0,
                                 '2010': 0.074092644484028,
                                 '2011': 0.5789763970300605},
                                {'2009': 0.0,
                                 '2010': 0.222277933452084,
                                 '2011': 1.7369291910901816},
                                None, None,
                                {'2009': 0.0,
                                 '2010': 0.0,
                                 '2011': 0.0},
                                {'2009': 0.0,
                                 '2010': 0.074092644484028,
                                 '2011': 0.5789763970300605}, None,
                                {'2009': 0.0,
                                 '2010': 0.222277933452084,
                                 '2011': 1.7369291910901816},
                                None, None,
                                {'2009': 0.0,
                                 '2010': 0.0,
                                 '2011': 0.0},
                                {'2009': 0.0,
                                 '2010': 0.0,
                                 '2011': 0.0},
                                {'2009': 0.0,
                                 '2010': 0.0,
                                 '2011': 0.0},
                                None, None,
                                {'2009': 0.0,
                                 '2010': 0.0,
                                 '2011': 0.0},
                                {'2009': 0.0,
                                 '2010': 0.0,
                                 '2011': 0.0},
                                {'2009': 0.0,
                                 '2010': 0.0,
                                 '2011': 0.0},
                                None, None,
                                {'2009': 0.0,
                                 '2010': 0.0,
                                 '2011': 0.0},
                                {'2009': 0.0,
                                 '2010': 0.148185288968056,
                                 '2011': 1.157952794060121},
                                {'2009': 0.0,
                                 '2010': 0.889111733808336,
                                 '2011': 1.7369291910901816},
                                {'2009': 0.0,
                                 '2010': 0.0,
                                 '2011': 0.0},
                                {'2009': 0.0,
                                 '2010': 0.148185288968056,
                                 '2011': 1.157952794060121},
                                {'2009': 0.0,
                                 '2010': 0.889111733808336,
                                 '2011': 1.7369291910901816},
                                {'2009': 0.0,
                                 '2010': 0.0,
                                 '2011': 0.0},
                                {'2009': 0.0,
                                 '2010': 0.0,
                                 '2011': 0.0},
                                {'2009': 0.0,
                                 '2010': 0.0,
                                 '2011': 0.0},
                                {'2009': 0.0,
                                 '2010': 0.0,
                                 '2011': 0.0},
                                {'2009': 0.0,
                                 '2010': 0.0,
                                 '2011': 0.0},
                                {'2009': 0.0,
                                 '2010': 0.0,
                                 '2011': 0.0},
                                {'2009': 0,
                                 '2010': 0,
                                 '2011': 0},
                                {'2009': 0,
                                 '2010': 0,
                                 '2011': 0},
                                {'2009': 0,
                                 '2010': 0,
                                 '2011': 0},
                                {'2009': 0,
                                 '2010': 0,
                                 '2011': 0},
                                {'2009': 0,
                                 '2010': 0,
                                 '2011': 0},
                                {'2009': 0,
                                 '2010': 0,
                                 '2011': 0},
                                {'2009': 0,
                                 '2010': 0,
                                 '2011': 0},
                                {'2009': 0.0,
                                 '2010': 0.0037046322242014,
                                 '2011': 0.019299213234335352},
                                1],
                               [{'2009': 0.0,
                                 '2010': 0.37046322242013996,
                                 '2011': 1.9299213234335353},
                                {'2009': 0.0,
                                 '2010': 0.074092644484028,
                                 '2011': 0.5789763970300605},
                                {'2009': 0.0,
                                 '2010': 0.222277933452084,
                                 '2011': 1.7369291910901816},
                                None, None,
                                {'2009': 0.0,
                                 '2010': 0.0444555866904168,
                                 '2011': 0.27604614550244105},
                                {'2009': 0.0,
                                 '2010': 0.06786886234736965,
                                 '2011': 0.5210067064745479}, None,
                                {'2009': 0.0,
                                 '2010': 0.20360658704210893,
                                 '2011': 1.563020119423644},
                                None, None,
                                {'2009': 0.0,
                                 '2010': 0.0444555866904168,
                                 '2011': 0.23159055881202426},
                                {'2009': 0.0,
                                 '2010': 0.00889111733808336,
                                 '2011': 0.06947716764360727},
                                {'2009': 0.0,
                                 '2010': 0.02667335201425008,
                                 '2011': 0.2084315029308218},
                                None, None,
                                {'2009': 0.0,
                                 '2010': 0.0444555866904168,
                                 '2011': 0.23159055881202426},
                                {'2009': 0.0,
                                 '2010': 0.002667335201425008,
                                 '2011': 0.02084315029308218},
                                {'2009': 0.0,
                                 '2010': 0.008002005604275024,
                                 '2011': 0.06252945087924654},
                                None, None,
                                {'2009': 0.0,
                                 '2010': 0.444555866904168,
                                 '2011': 2.7604614550244104},
                                {'2009': 0.0,
                                 '2010': 0.148185288968056,
                                 '2011': 1.157952794060121},
                                {'2009': 0.0,
                                 '2010': 0.889111733808336,
                                 '2011': 1.7369291910901816},
                                {'2009': 0.0,
                                 '2010': 0.889111733808336,
                                 '2011': 5.520922910048821},
                                {'2009': 0.0,
                                 '2010': 0.1357377246947393,
                                 '2011': 1.0420134129490959},
                                {'2009': 0.0,
                                 '2010': 0.8144263481684357,
                                 '2011': 1.563020119423644},
                                {'2009': 0.0,
                                 '2010': 0.444555866904168,
                                 '2011': 2.3159055881202426},
                                {'2009': 0.0,
                                 '2010': 0.01778223467616672,
                                 '2011': 0.13895433528721454},
                                {'2009': 0.0,
                                 '2010': 0.10669340805700032,
                                 '2011': 0.2084315029308218},
                                {'2009': 0.0,
                                 '2010': 0.889111733808336,
                                 '2011': 4.631811176240485},
                                {'2009': 0.0,
                                 '2010': 0.005334670402850016,
                                 '2011': 0.04168630058616436},
                                {'2009': 0.0,
                                 '2010': 0.032008022417100095,
                                 '2011': 0.06252945087924654},
                                {'2009': 0,
                                 '2010': 0,
                                 '2011': 0},
                                {'2009': 0,
                                 '2010': 0,
                                 '2011': 0},
                                {'2009': 0,
                                 '2010': 0,
                                 '2011': 0},
                                {'2009': 0,
                                 '2010': 0,
                                 '2011': 0},
                                {'2009': 0,
                                 '2010': 0,
                                 '2011': 0},
                                {'2009': 0,
                                 '2010': 0,
                                 '2011': 0},
                                {'2009': 0,
                                 '2010': 0,
                                 '2011': 0},
                                {'2009': 0.0,
                                 '2010': 0.0037046322242014,
                                 '2011': 0.019299213234335352},
                                1]]]
    ok_out_bad_string = [[[{'2009': 100,
                                '2010': 100,
                                '2011': 100},
                               {'2009': 10,
                                '2010': 20,
                                '2011': 30},
                               {'2009': 30,
                                '2010': 60,
                                '2011': 90},
                               None, None,
                               {'2009': 100,
                                '2010': 100,
                                '2011': 100},
                               {'2009': 3.0,
                                '2010': 6.0,
                                '2011': 9.0}, None,
                               {'2009': 9.0,
                                '2010': 18.0,
                                '2011': 27.0},
                               None, None,
                               {'2009': 100,
                                '2010': 100,
                                '2011': 100},
                               {'2009': 10,
                                '2010': 20,
                                '2011': 30},
                               {'2009': 30,
                                '2010': 60,
                                '2011': 90},
                               None, None,
                               {'2009': 100,
                                '2010': 100,
                                '2011': 100},
                               {'2009': 3.0,
                                '2010': 6.0,
                                '2011': 9.0},
                               {'2009': 9.0,
                                '2010': 18.0,
                                '2011': 27.0},
                               None, None,
                               {'2009': 1000,
                                '2010': 1000,
                                '2011': 1000},
                               {'2009': 10.0,
                                '2010': 40.0,
                                '2011': 60.0},
                               {'2009': 30.0,
                                '2010': 240.0,
                                '2011': 90.0},
                               {'2009': 2000,
                                '2010': 2000,
                                '2011': 2000},
                               {'2009': 3.0,
                                '2010': 12.0,
                                '2011': 18.0},
                               {'2009': 9.0,
                                '2010': 72.0,
                                '2011': 27.0},
                               {'2009': 1000,
                                '2010': 1000,
                                '2011': 1000},
                               {'2009': 10.0,
                                '2010': 40.0,
                                '2011': 60.0},
                               {'2009': 30.0,
                                '2010': 240.0,
                                '2011': 90.0},
                               {'2009': 2000,
                                '2010': 2000,
                                '2011': 2000},
                               {'2009': 3.0,
                                '2010': 12.0,
                                '2011': 18.0},
                               {'2009': 9.0,
                                '2010': 72.0,
                                '2011': 27.0},
                               {'2009': 0,
                                '2010': 0,
                                '2011': 0},
                               {'2009': 0,
                                '2010': 0,
                                '2011': 0},
                               {'2009': 0,
                                '2010': 0,
                                '2011': 0},
                               {'2009': 0,
                                '2010': 0,
                                '2011': 0},
                               {'2009': 0,
                                '2010': 0,
                                '2011': 0},
                               {'2009': 0,
                                '2010': 0,
                                '2011': 0},
                               {'2009': 0,
                                '2010': 0,
                                '2011': 0},
                               {'2009': 1,
                                '2010': 1,
                                '2011': 1},
                               1],
                              [{'2009': 100,
                                '2010': 100,
                                '2011': 100},
                               {'2009': 10,
                                '2010': 20,
                                '2011': 30},
                               {'2009': 30,
                                '2010': 60,
                                '2011': 90},
                               None, None,
                               {'2009': 100,
                                '2010': 100,
                                '2011': 100},
                               {'2009': 3.0,
                                '2010': 6.0,
                                '2011': 9.0}, None,
                               {'2009': 9.0,
                                '2010': 18.0,
                                '2011': 27.0},
                               None, None,
                               {'2009': 100,
                                '2010': 100,
                                '2011': 100},
                               {'2009': 10,
                                '2010': 20,
                                '2011': 30},
                               {'2009': 30,
                                '2010': 60,
                                '2011': 90},
                               None, None,
                               {'2009': 100,
                                '2010': 100,
                                '2011': 100},
                               {'2009': 3.0,
                                '2010': 6.0,
                                '2011': 9.0},
                               {'2009': 9.0,
                                '2010': 18.0,
                                '2011': 27.0},
                               None, None,
                               {'2009': 1000,
                                '2010': 1000,
                                '2011': 1000},
                               {'2009': 10.0,
                                '2010': 40.0,
                                '2011': 60.0},
                               {'2009': 30.0,
                                '2010': 240.0,
                                '2011': 90.0},
                               {'2009': 2000,
                                '2010': 2000,
                                '2011': 2000},
                               {'2009': 3.0,
                                '2010': 12.0,
                                '2011': 18.0},
                               {'2009': 9.0,
                                '2010': 72.0,
                                '2011': 27.0},
                               {'2009': 1000,
                                '2010': 1000,
                                '2011': 1000},
                               {'2009': 10.0,
                                '2010': 40.0,
                                '2011': 60.0},
                               {'2009': 30.0,
                                '2010': 240.0,
                                '2011': 90.0},
                               {'2009': 2000,
                                '2010': 2000,
                                '2011': 2000},
                               {'2009': 3.0,
                                '2010': 12.0,
                                '2011': 18.0},
                               {'2009': 9.0,
                                '2010': 72.0,
                                '2011': 27.0},
                               {'2009': 0,
                                '2010': 0,
                                '2011': 0},
                               {'2009': 0,
                                '2010': 0,
                                '2011': 0},
                               {'2009': 0,
                                '2010': 0,
                                '2011': 0},
                               {'2009': 0,
                                '2010': 0,
                                '2011': 0},
                               {'2009': 0,
                                '2010': 0,
                                '2011': 0},
                               {'2009': 0,
                                '2010': 0,
                                '2011': 0},
                               {'2009': 0,
                                '2010': 0,
                                '2011': 0},
                               {'2009': 1,
                                '2010': 1,
                                '2011': 1},
                               1]],
                             [[{'2009': 100,
                                '2010': 100,
                                '2011': 100},
                               {'2009': 10,
                                '2010': 20,
                                '2011': 30},
                               {'2009': 30,
                                '2010': 60,
                                '2011': 90},
                               None, None,
                               {'2009': 100,
                                '2010': 100.0,
                                '2011': 100.0},
                               {'2009': 3.0,
                                '2010': 6.0,
                                '2011': 9.0}, None,
                               {'2009': 9.0,
                                '2010': 18.0,
                                '2011': 27.0},
                               None, None,
                               {'2009': 100,
                                '2010': 0.0,
                                '2011': 0.0},
                               {'2009': 10,
                                '2010': 0.0,
                                '2011': 0.0},
                               {'2009': 30,
                                '2010': 0.0,
                                '2011': 0.0},
                               None, None,
                               {'2009': 100,
                                '2010': 0.0,
                                '2011': 0.0},
                               {'2009': 3.0,
                                '2010': 0.0,
                                '2011': 0.0},
                               {'2009': 9.0,
                                '2010': 0.0,
                                '2011': 0.0},
                               None, None,
                               {'2009': 1000,
                                '2010': 1000.0,
                                '2011': 1000.0},
                               {'2009': 10.0,
                                '2010': 40.0,
                                '2011': 60.0},
                               {'2009': 30.0,
                                '2010': 240.0,
                                '2011': 90.0},
                               {'2009': 2000,
                                '2010': 2000.0,
                                '2011': 2000.0},
                               {'2009': 3.0,
                                '2010': 12.0,
                                '2011': 18.0},
                               {'2009': 9.0,
                                '2010': 72.0,
                                '2011': 27.0},
                               {'2009': 1000,
                                '2010': 0.0,
                                '2011': 0.0},
                               {'2009': 10.0,
                                '2010': 0.0,
                                '2011': 0.0},
                               {'2009': 30.0,
                                '2010': 0.0,
                                '2011': 0.0},
                               {'2009': 2000,
                                '2010': 0.0,
                                '2011': 0.0},
                               {'2009': 3.0,
                                '2010': 0.0,
                                '2011': 0.0},
                               {'2009': 9.0,
                                '2010': 0.0,
                                '2011': 0.0},
                               {'2009': 0,
                                '2010': 0,
                                '2011': 0},
                               {'2009': 0,
                                '2010': 0,
                                '2011': 0},
                               {'2009': 0,
                                '2010': 0,
                                '2011': 0},
                               {'2009': 0,
                                '2010': 0,
                                '2011': 0},
                               {'2009': 0,
                                '2010': 0,
                                '2011': 0},
                               {'2009': 0,
                                '2010': 0,
                                '2011': 0},
                               {'2009': 0,
                                '2010': 0,
                                '2011': 0},
                               {'2009': 1,
                                '2010': 1,
                                '2011': 1},
                               1],
                              [{'2009': 100,
                                '2010': 100,
                                '2011': 100},
                               {'2009': 10,
                                '2010': 20,
                                '2011': 30},
                               {'2009': 30,
                                '2010': 60,
                                '2011': 90},
                               None, None,
                               {'2009': 12.000000000000002,
                                '2010': 24.000000000000004,
                                '2011': 36.00000000000001},
                               {'2009': 9.16,
                                '2010': 16.64,
                                '2011': 22.439999999999998}, None,
                               {'2009': 27.479999999999997,
                                '2010': 49.92,
                                '2011': 67.32000000000001},
                               None, None,
                               {'2009': 12.000000000000002,
                                '2010': 12.000000000000002,
                                '2011': 12.000000000000002},
                               {'2009': 1.2000000000000002,
                                '2010': 2.4000000000000004,
                                '2011': 3.6},
                               {'2009': 3.6,
                                '2010': 7.2,
                                '2011': 10.8},
                               None, None,
                               {'2009': 12.000000000000002,
                                '2010': 12.000000000000002,
                                '2011': 12.000000000000002},
                               {'2009': 0.36000000000000004,
                                '2010': 0.7200000000000001,
                                '2011': 1.08},
                               {'2009': 1.08,
                                '2010': 2.16,
                                '2011': 3.24},
                               None, None,
                               {'2009': 120.00000000000001,
                                '2010': 240.00000000000003,
                                '2011': 360.00000000000006},
                               {'2009': 10.0,
                                '2010': 40.0,
                                '2011': 60.0},
                               {'2009': 30.0,
                                '2010': 240.0,
                                '2011': 90.0},
                               {'2009': 240.00000000000003,
                                '2010': 480.00000000000006,
                                '2011': 720.0000000000001},
                               {'2009': 9.16,
                                '2010': 33.28,
                                '2011': 44.879999999999995},
                               {'2009': 27.479999999999997,
                                '2010': 199.68,
                                '2011': 67.32000000000001},
                               {'2009': 120.00000000000001,
                                '2010': 120.00000000000001,
                                '2011': 120.00000000000001},
                               {'2009': 1.2000000000000002,
                                '2010': 4.800000000000001,
                                '2011': 7.2},
                               {'2009': 3.6,
                                '2010': 28.8,
                                '2011': 10.8},
                               {'2009': 240.00000000000003,
                                '2010': 240.00000000000003,
                                '2011': 240.00000000000003},
                               {'2009': 0.36000000000000004,
                                '2010': 1.4400000000000002,
                                '2011': 2.16},
                               {'2009': 1.08,
                                '2010': 8.64,
                                '2011': 3.24},
                               {'2009': 0,
                                '2010': 0,
                                '2011': 0},
                               {'2009': 0,
                                '2010': 0,
                                '2011': 0},
                               {'2009': 0,
                                '2010': 0,
                                '2011': 0},
                               {'2009': 0,
                                '2010': 0,
                                '2011': 0},
                               {'2009': 0,
                                '2010': 0,
                                '2011': 0},
                               {'2009': 0,
                                '2010': 0,
                                '2011': 0},
                               {'2009': 0,
                                '2010': 0,
                                '2011': 0},
                               {'2009': 1,
                                '2010': 1,
                                '2011': 1},
                               1]]]
    ok_out_bad_values = [[[{'2009': 0.0,
                                '2010': 0.0,
                                '2011': 0.0},
                               {'2009': 0.0,
                                '2010': 0.0,
                                '2011': 0.0},
                               {'2009': 0.0,
                                '2010': 0.0,
                                '2011': 0.0},
                               None, None,
                               {'2009': 0.0,
                                '2010': 0.0,
                                '2011': 0.0},
                               {'2009': 0.0,
                                '2010': 0.0,
                                '2011': 0.0}, None,
                               {'2009': 0.0,
                                '2010': 0.0,
                                '2011': 0.0},
                               None, None,
                               {'2009': 0.0,
                                '2010': 0.0,
                                '2011': 0.0},
                               {'2009': 0.0,
                                '2010': 0.0,
                                '2011': 0.0},
                               {'2009': 0.0,
                                '2010': 0.0,
                                '2011': 0.0},
                               None, None,
                               {'2009': 0.0,
                                '2010': 0.0,
                                '2011': 0.0},
                               {'2009': 0.0,
                                '2010': 0.0,
                                '2011': 0.0},
                               {'2009': 0.0,
                                '2010': 0.0,
                                '2011': 0.0},
                               None, None,
                               {'2009': 0.0,
                                '2010': 0.0,
                                '2011': 0.0},
                               {'2009': 0.0,
                                '2010': 0.0,
                                '2011': 0.0},
                               {'2009': 0.0,
                                '2010': 0.0,
                                '2011': 0.0},
                               {'2009': 0.0,
                                '2010': 0.0,
                                '2011': 0.0},
                               {'2009': 0.0,
                                '2010': 0.0,
                                '2011': 0.0},
                               {'2009': 0.0,
                                '2010': 0.0,
                                '2011': 0.0},
                               {'2009': 0.0,
                                '2010': 0.0,
                                '2011': 0.0},
                               {'2009': 0.0,
                                '2010': 0.0,
                                '2011': 0.0},
                               {'2009': 0.0,
                                '2010': 0.0,
                                '2011': 0.0},
                               {'2009': 0.0,
                                '2010': 0.0,
                                '2011': 0.0},
                               {'2009': 0.0,
                                '2010': 0.0,
                                '2011': 0.0},
                               {'2009': 0.0,
                                '2010': 0.0,
                                '2011': 0.0},
                               {'2009': 0,
                                '2010': 0,
                                '2011': 0},
                               {'2009': 0,
                                '2010': 0,
                                '2011': 0},
                               {'2009': 0,
                                '2010': 0,
                                '2011': 0},
                               {'2009': 0,
                                '2010': 0,
                                '2011': 0},
                               {'2009': 0,
                                '2010': 0,
                                '2011': 0},
                               {'2009': 0,
                                '2010': 0,
                                '2011': 0},
                               {'2009': 0,
                                '2010': 0,
                                '2011': 0},
                               {'2009': 0.0,
                                '2010': 0.0,
                                '2011': 0.0},
                               1],
                              [{'2009': 0.0,
                                '2010': 0.0,
                                '2011': 0.0},
                               {'2009': 0.0,
                                '2010': 0.0,
                                '2011': 0.0},
                               {'2009': 0.0,
                                '2010': 0.0,
                                '2011': 0.0},
                               None, None,
                               {'2009': 0.0,
                                '2010': 0.0,
                                '2011': 0.0},
                               {'2009': 0.0,
                                '2010': 0.0,
                                '2011': 0.0}, None,
                               {'2009': 0.0,
                                '2010': 0.0,
                                '2011': 0.0},
                               None, None,
                               {'2009': 0.0,
                                '2010': 0.0,
                                '2011': 0.0},
                               {'2009': 0.0,
                                '2010': 0.0,
                                '2011': 0.0},
                               {'2009': 0.0,
                                '2010': 0.0,
                                '2011': 0.0},
                               None, None,
                               {'2009': 0.0,
                                '2010': 0.0,
                                '2011': 0.0},
                               {'2009': 0.0,
                                '2010': 0.0,
                                '2011': 0.0},
                               {'2009': 0.0,
                                '2010': 0.0,
                                '2011': 0.0},
                               None, None,
                               {'2009': 0.0,
                                '2010': 0.0,
                                '2011': 0.0},
                               {'2009': 0.0,
                                '2010': 0.0,
                                '2011': 0.0},
                               {'2009': 0.0,
                                '2010': 0.0,
                                '2011': 0.0},
                               {'2009': 0.0,
                                '2010': 0.0,
                                '2011': 0.0},
                               {'2009': 0.0,
                                '2010': 0.0,
                                '2011': 0.0},
                               {'2009': 0.0,
                                '2010': 0.0,
                                '2011': 0.0},
                               {'2009': 0.0,
                                '2010': 0.0,
                                '2011': 0.0},
                               {'2009': 0.0,
                                '2010': 0.0,
                                '2011': 0.0},
                               {'2009': 0.0,
                                '2010': 0.0,
                                '2011': 0.0},
                               {'2009': 0.0,
                                '2010': 0.0,
                                '2011': 0.0},
                               {'2009': 0.0,
                                '2010': 0.0,
                                '2011': 0.0},
                               {'2009': 0.0,
                                '2010': 0.0,
                                '2011': 0.0},
                               {'2009': 0,
                                '2010': 0,
                                '2011': 0},
                               {'2009': 0,
                                '2010': 0,
                                '2011': 0},
                               {'2009': 0,
                                '2010': 0,
                                '2011': 0},
                               {'2009': 0,
                                '2010': 0,
                                '2011': 0},
                               {'2009': 0,
                                '2010': 0,
                                '2011': 0},
                               {'2009': 0,
                                '2010': 0,
                                '2011': 0},
                               {'2009': 0,
                                '2010': 0,
                                '2011': 0},
                               {'2009': 0.0,
                                '2010': 0.0,
                                '2011': 0.0},
                               1]],
                             [[{'2009': 0.0,
                                '2010': 0.0,
                                '2011': 0.0},
                               {'2009': 0.0,
                                '2010': 0.0,
                                '2011': 0.0},
                               {'2009': 0.0,
                                '2010': 0.0,
                                '2011': 0.0},
                               None, None,
                               {'2009': 0.0,
                                '2010': 0.0,
                                '2011': 0.0},
                               {'2009': 0.0,
                                '2010': 0.0,
                                '2011': 0.0}, None,
                               {'2009': 0.0,
                                '2010': 0.0,
                                '2011': 0.0},
                               None, None,
                               {'2009': 0.0,
                                '2010': 0.0,
                                '2011': 0.0},
                               {'2009': 0.0,
                                '2010': 0.0,
                                '2011': 0.0},
                               {'2009': 0.0,
                                '2010': 0.0,
                                '2011': 0.0},
                               None, None,
                               {'2009': 0.0,
                                '2010': 0.0,
                                '2011': 0.0},
                               {'2009': 0.0,
                                '2010': 0.0,
                                '2011': 0.0},
                               {'2009': 0.0,
                                '2010': 0.0,
                                '2011': 0.0},
                               None, None,
                               {'2009': 0.0,
                                '2010': 0.0,
                                '2011': 0.0},
                               {'2009': 0.0,
                                '2010': 0.0,
                                '2011': 0.0},
                               {'2009': 0.0,
                                '2010': 0.0,
                                '2011': 0.0},
                               {'2009': 0.0,
                                '2010': 0.0,
                                '2011': 0.0},
                               {'2009': 0.0,
                                '2010': 0.0,
                                '2011': 0.0},
                               {'2009': 0.0,
                                '2010': 0.0,
                                '2011': 0.0},
                               {'2009': 0.0,
                                '2010': 0.0,
                                '2011': 0.0},
                               {'2009': 0.0,
                                '2010': 0.0,
                                '2011': 0.0},
                               {'2009': 0.0,
                                '2010': 0.0,
                                '2011': 0.0},
                               {'2009': 0.0,
                                '2010': 0.0,
                                '2011': 0.0},
                               {'2009': 0.0,
                                '2010': 0.0,
                                '2011': 0.0},
                               {'2009': 0.0,
                                '2010': 0.0,
                                '2011': 0.0},
                               {'2009': 0,
                                '2010': 0,
                                '2011': 0},
                               {'2009': 0,
                                '2010': 0,
                                '2011': 0},
                               {'2009': 0,
                                '2010': 0,
                                '2011': 0},
                               {'2009': 0,
                                '2010': 0,
                                '2011': 0},
                               {'2009': 0,
                                '2010': 0,
                                '2011': 0},
                               {'2009': 0,
                                '2010': 0,
                                '2011': 0},
                               {'2009': 0,
                                '2010': 0,
                                '2011': 0},
                               {'2009': 0.0,
                                '2010': 0.0,
                                '2011': 0.0},
                               1],
                              [{'2009': 0.0,
                                '2010': 0.0,
                                '2011': 0.0},
                               {'2009': 0.0,
                                '2010': 0.0,
                                '2011': 0.0},
                               {'2009': 0.0,
                                '2010': 0.0,
                                '2011': 0.0},
                               None, None,
                               {'2009': 0.0,
                                '2010': 0.0,
                                '2011': 0.0},
                               {'2009': 0.0,
                                '2010': 0.0,
                                '2011': 0.0}, None,
                               {'2009': 0.0,
                                '2010': 0.0,
                                '2011': 0.0},
                               None, None,
                               {'2009': 0.0,
                                '2010': 0.0,
                                '2011': 0.0},
                               {'2009': 0.0,
                                '2010': 0.0,
                                '2011': 0.0},
                               {'2009': 0.0,
                                '2010': 0.0,
                                '2011': 0.0},
                               None, None,
                               {'2009': 0.0,
                                '2010': 0.0,
                                '2011': 0.0},
                               {'2009': 0.0,
                                '2010': 0.0,
                                '2011': 0.0},
                               {'2009': 0.0,
                                '2010': 0.0,
                                '2011': 0.0},
                               None, None,
                               {'2009': 0.0,
                                '2010': 0.0,
                                '2011': 0.0},
                               {'2009': 0.0,
                                '2010': 0.0,
                                '2011': 0.0},
                               {'2009': 0.0,
                                '2010': 0.0,
                                '2011': 0.0},
                               {'2009': 0.0,
                                '2010': 0.0,
                                '2011': 0.0},
                               {'2009': 0.0,
                                '2010': 0.0,
                                '2011': 0.0},
                               {'2009': 0.0,
                                '2010': 0.0,
                                '2011': 0.0},
                               {'2009': 0.0,
                                '2010': 0.0,
                                '2011': 0.0},
                               {'2009': 0.0,
                                '2010': 0.0,
                                '2011': 0.0},
                               {'2009': 0.0,
                                '2010': 0.0,
                                '2011': 0.0},
                               {'2009': 0.0,
                                '2010': 0.0,
                                '2011': 0.0},
                               {'2009': 0.0,
                                '2010': 0.0,
                                '2011': 0.0},
                               {'2009': 0.0,
                                '2010': 0.0,
                                '2011': 0.0},
                               {'2009': 0,
                                '2010': 0,
                                '2011': 0},
                               {'2009': 0,
                                '2010': 0,
                                '2011': 0},
                               {'2009': 0,
                                '2010': 0,
                                '2011': 0},
                               {'2009': 0,
                                '2010': 0,
                                '2011': 0},
                               {'2009': 0,
                                '2010': 0,
                                '2011': 0},
                               {'2009': 0,
                                '2010': 0,
                                '2011': 0},
                               {'2009': 0,
                                '2010': 0,
                                '2011': 0},
                               {'2009': 0.0,
                                '2010': 0.0,
                                '2011': 0.0},
                               1]]]
    ok_out_wrong_name = [[[{'2009': 100,
                                '2010': 100,
                                '2011': 100},
                               {'2009': 10,
                                '2010': 20,
                                '2011': 30},
                               {'2009': 30,
                                '2010': 60,
                                '2011': 90},
                               None, None,
                               {'2009': 100,
                                '2010': 100,
                                '2011': 100},
                               {'2009': 3.0,
                                '2010': 6.0,
                                '2011': 9.0}, None,
                               {'2009': 9.0,
                                '2010': 18.0,
                                '2011': 27.0},
                               None, None,
                               {'2009': 100,
                                '2010': 100,
                                '2011': 100},
                               {'2009': 10,
                                '2010': 20,
                                '2011': 30},
                               {'2009': 30,
                                '2010': 60,
                                '2011': 90},
                               None, None,
                               {'2009': 100,
                                '2010': 100,
                                '2011': 100},
                               {'2009': 3.0,
                                '2010': 6.0,
                                '2011': 9.0},
                               {'2009': 9.0,
                                '2010': 18.0,
                                '2011': 27.0},
                               None, None,
                               {'2009': 1000,
                                '2010': 1000,
                                '2011': 1000},
                               {'2009': 10.0,
                                '2010': 40.0,
                                '2011': 60.0},
                               {'2009': 30.0,
                                '2010': 240.0,
                                '2011': 90.0},
                               {'2009': 2000,
                                '2010': 2000,
                                '2011': 2000},
                               {'2009': 3.0,
                                '2010': 12.0,
                                '2011': 18.0},
                               {'2009': 9.0,
                                '2010': 72.0,
                                '2011': 27.0},
                               {'2009': 1000,
                                '2010': 1000,
                                '2011': 1000},
                               {'2009': 10.0,
                                '2010': 40.0,
                                '2011': 60.0},
                               {'2009': 30.0,
                                '2010': 240.0,
                                '2011': 90.0},
                               {'2009': 2000,
                                '2010': 2000,
                                '2011': 2000},
                               {'2009': 3.0,
                                '2010': 12.0,
                                '2011': 18.0},
                               {'2009': 9.0,
                                '2010': 72.0,
                                '2011': 27.0},
                               {'2009': 0,
                                '2010': 0,
                                '2011': 0},
                               {'2009': 0,
                                '2010': 0,
                                '2011': 0},
                               {'2009': 0,
                                '2010': 0,
                                '2011': 0},
                               {'2009': 0,
                                '2010': 0,
                                '2011': 0},
                               {'2009': 0,
                                '2010': 0,
                                '2011': 0},
                               {'2009': 0,
                                '2010': 0,
                                '2011': 0},
                               {'2009': 0,
                                '2010': 0,
                                '2011': 0},
                               {'2009': 1,
                                '2010': 1,
                                '2011': 1},
                               1],
                              [{'2009': 100,
                                '2010': 100,
                                '2011': 100},
                               {'2009': 10,
                                '2010': 20,
                                '2011': 30},
                               {'2009': 30,
                                '2010': 60,
                                '2011': 90},
                               None, None,
                               {'2009': 100,
                                '2010': 100,
                                '2011': 100},
                               {'2009': 3.0,
                                '2010': 6.0,
                                '2011': 9.0}, None,
                               {'2009': 9.0,
                                '2010': 18.0,
                                '2011': 27.0},
                               None, None,
                               {'2009': 100,
                                '2010': 100,
                                '2011': 100},
                               {'2009': 10,
                                '2010': 20,
                                '2011': 30},
                               {'2009': 30,
                                '2010': 60,
                                '2011': 90},
                               None, None,
                               {'2009': 100,
                                '2010': 100,
                                '2011': 100},
                               {'2009': 3.0,
                                '2010': 6.0,
                                '2011': 9.0},
                               {'2009': 9.0,
                                '2010': 18.0,
                                '2011': 27.0},
                               None, None,
                               {'2009': 1000,
                                '2010': 1000,
                                '2011': 1000},
                               {'2009': 10.0,
                                '2010': 40.0,
                                '2011': 60.0},
                               {'2009': 30.0,
                                '2010': 240.0,
                                '2011': 90.0},
                               {'2009': 2000,
                                '2010': 2000,
                                '2011': 2000},
                               {'2009': 3.0,
                                '2010': 12.0,
                                '2011': 18.0},
                               {'2009': 9.0,
                                '2010': 72.0,
                                '2011': 27.0},
                               {'2009': 1000,
                                '2010': 1000,
                                '2011': 1000},
                               {'2009': 10.0,
                                '2010': 40.0,
                                '2011': 60.0},
                               {'2009': 30.0,
                                '2010': 240.0,
                                '2011': 90.0},
                               {'2009': 2000,
                                '2010': 2000,
                                '2011': 2000},
                               {'2009': 3.0,
                                '2010': 12.0,
                                '2011': 18.0},
                               {'2009': 9.0,
                                '2010': 72.0,
                                '2011': 27.0},
                               {'2009': 0,
                                '2010': 0,
                                '2011': 0},
                               {'2009': 0,
                                '2010': 0,
                                '2011': 0},
                               {'2009': 0,
                                '2010': 0,
                                '2011': 0},
                               {'2009': 0,
                                '2010': 0,
                                '2011': 0},
                               {'2009': 0,
                                '2010': 0,
                                '2011': 0},
                               {'2009': 0,
                                '2010': 0,
                                '2011': 0},
                               {'2009': 0,
                                '2010': 0,
                                '2011': 0},
                               {'2009': 1,
                                '2010': 1,
                                '2011': 1},
                               1]],
                             [[{'2009': 100,
                                '2010': 100,
                                '2011': 100},
                               {'2009': 10,
                                '2010': 20,
                                '2011': 30},
                               {'2009': 30,
                                '2010': 60,
                                '2011': 90},
                               None, None,
                               {'2009': 100,
                                '2010': 100.0,
                                '2011': 100.0},
                               {'2009': 3.0,
                                '2010': 6.0,
                                '2011': 9.0}, None,
                               {'2009': 9.0,
                                '2010': 18.0,
                                '2011': 27.0},
                               None, None,
                               {'2009': 100,
                                '2010': 0.0,
                                '2011': 0.0},
                               {'2009': 10,
                                '2010': 0.0,
                                '2011': 0.0},
                               {'2009': 30,
                                '2010': 0.0,
                                '2011': 0.0},
                               None, None,
                               {'2009': 100,
                                '2010': 0.0,
                                '2011': 0.0},
                               {'2009': 3.0,
                                '2010': 0.0,
                                '2011': 0.0},
                               {'2009': 9.0,
                                '2010': 0.0,
                                '2011': 0.0},
                               None, None,
                               {'2009': 1000,
                                '2010': 1000.0,
                                '2011': 1000.0},
                               {'2009': 10.0,
                                '2010': 40.0,
                                '2011': 60.0},
                               {'2009': 30.0,
                                '2010': 240.0,
                                '2011': 90.0},
                               {'2009': 2000,
                                '2010': 2000.0,
                                '2011': 2000.0},
                               {'2009': 3.0,
                                '2010': 12.0,
                                '2011': 18.0},
                               {'2009': 9.0,
                                '2010': 72.0,
                                '2011': 27.0},
                               {'2009': 1000,
                                '2010': 0.0,
                                '2011': 0.0},
                               {'2009': 10.0,
                                '2010': 0.0,
                                '2011': 0.0},
                               {'2009': 30.0,
                                '2010': 0.0,
                                '2011': 0.0},
                               {'2009': 2000,
                                '2010': 0.0,
                                '2011': 0.0},
                               {'2009': 3.0,
                                '2010': 0.0,
                                '2011': 0.0},
                               {'2009': 9.0,
                                '2010': 0.0,
                                '2011': 0.0},
                               {'2009': 0,
                                '2010': 0,
                                '2011': 0},
                               {'2009': 0,
                                '2010': 0,
                                '2011': 0},
                               {'2009': 0,
                                '2010': 0,
                                '2011': 0},
                               {'2009': 0,
                                '2010': 0,
                                '2011': 0},
                               {'2009': 0,
                                '2010': 0,
                                '2011': 0},
                               {'2009': 0,
                                '2010': 0,
                                '2011': 0},
                               {'2009': 0,
                                '2010': 0,
                                '2011': 0},
                               {'2009': 1,
                                '2010': 1,
                                '2011': 1},
                               1],
                              [{'2009': 100,
                                '2010': 100,
                                '2011': 100},
                               {'2009': 10,
                                '2010': 20,
                                '2011': 30},
                               {'2009': 30,
                                '2010': 60,
                                '2011': 90},
                               None, None,
                               {'2009': 12.000000000000002,
                                '2010': 24.000000000000004,
                                '2011': 36.00000000000001},
                               {'2009': 9.16,
                                '2010': 16.64,
                                '2011': 22.439999999999998}, None,
                               {'2009': 27.479999999999997,
                                '2010': 49.92,
                                '2011': 67.32000000000001},
                               None, None,
                               {'2009': 12.000000000000002,
                                '2010': 12.000000000000002,
                                '2011': 12.000000000000002},
                               {'2009': 1.2000000000000002,
                                '2010': 2.4000000000000004,
                                '2011': 3.6},
                               {'2009': 3.6,
                                '2010': 7.2,
                                '2011': 10.8},
                               None, None,
                               {'2009': 12.000000000000002,
                                '2010': 12.000000000000002,
                                '2011': 12.000000000000002},
                               {'2009': 0.36000000000000004,
                                '2010': 0.7200000000000001,
                                '2011': 1.08},
                               {'2009': 1.08,
                                '2010': 2.16,
                                '2011': 3.24},
                               None, None,
                               {'2009': 120.00000000000001,
                                '2010': 240.00000000000003,
                                '2011': 360.00000000000006},
                               {'2009': 10.0,
                                '2010': 40.0,
                                '2011': 60.0},
                               {'2009': 30.0,
                                '2010': 240.0,
                                '2011': 90.0},
                               {'2009': 240.00000000000003,
                                '2010': 480.00000000000006,
                                '2011': 720.0000000000001},
                               {'2009': 9.16,
                                '2010': 33.28,
                                '2011': 44.879999999999995},
                               {'2009': 27.479999999999997,
                                '2010': 199.68,
                                '2011': 67.32000000000001},
                               {'2009': 120.00000000000001,
                                '2010': 120.00000000000001,
                                '2011': 120.00000000000001},
                               {'2009': 1.2000000000000002,
                                '2010': 4.800000000000001,
                                '2011': 7.2},
                               {'2009': 3.6,
                                '2010': 28.8,
                                '2011': 10.8},
                               {'2009': 240.00000000000003,
                                '2010': 240.00000000000003,
                                '2011': 240.00000000000003},
                               {'2009': 0.36000000000000004,
                                '2010': 1.4400000000000002,
                                '2011': 2.16},
                               {'2009': 1.08,
                                '2010': 8.64,
                                '2011': 3.24},
                               {'2009': 0,
                                '2010': 0,
                                '2011': 0},
                               {'2009': 0,
                                '2010': 0,
                                '2011': 0},
                               {'2009': 0,
                                '2010': 0,
                                '2011': 0},
                               {'2009': 0,
                                '2010': 0,
                                '2011': 0},
                               {'2009': 0,
                                '2010': 0,
                                '2011': 0},
                               {'2009': 0,
                                '2010': 0,
                                '2011': 0},
                               {'2009': 0,
                                '2010': 0,
                                '2011': 0},
                               {'2009': 1,
                                '2010': 1,
                                '2011': 1},
                               1]]]

    ok_out = [[[
            {"2009": 100, "2010": 100, "2011": 100},
            {"2009": 10, "2010": 20, "2011": 30},
            {"2009": 30, "2010": 60, "2011": 90},
            None, None,
            {"2009": 100, "2010": 100, "2011": 100},
            {"2009": 3, "2010": 6, "2011": 9}, None,
            {"2009": 9, "2010": 18, "2011": 27},
            None, None,
            {"2009": 100, "2010": 100, "2011": 100},
            {"2009": 10, "2010": 20, "2011": 30},
            {"2009": 30, "2010": 60, "2011": 90},
            None, None,
            {"2009": 100, "2010": 100, "2011": 100},
            {"2009": 3, "2010": 6, "2011": 9},
            {"2009": 9, "2010": 18, "2011": 27},
            None, None,
            {"2009": 1000, "2010": 1000, "2011": 1000},
            {"2009": 10, "2010": 40, "2011": 60},
            {"2009": 30, "2010": 240, "2011": 90},
            {"2009": 2000, "2010": 2000, "2011": 2000},
            {"2009": 3, "2010": 12, "2011": 18},
            {"2009": 9, "2010": 72, "2011": 27},
            {"2009": 1000, "2010": 1000, "2011": 1000},
            {"2009": 10, "2010": 40, "2011": 60},
            {"2009": 30, "2010": 240, "2011": 90},
            {"2009": 2000, "2010": 2000, "2011": 2000},
            {"2009": 3, "2010": 12, "2011": 18},
            {"2009": 9, "2010": 72, "2011": 27},
            {"2009": 0, "2010": 0, "2011": 0},
            {"2009": 0, "2010": 0, "2011": 0},
            {"2009": 0, "2010": 0, "2011": 0},
            {"2009": 0, "2010": 0, "2011": 0},
            {"2009": 0, "2010": 0, "2011": 0},
            {"2009": 0, "2010": 0, "2011": 0},
            {"2009": 0, "2010": 0, "2011": 0},
            {"2009": 1, "2010": 1, "2011": 1},
            1],
            [
            {"2009": 100, "2010": 100, "2011": 100},
            {"2009": 10, "2010": 20, "2011": 30},
            {"2009": 30, "2010": 60, "2011": 90},
            None, None,
            {"2009": 100, "2010": 100, "2011": 100},
            {"2009": 3, "2010": 6, "2011": 9},
            {"2009": 9, "2010": 18, "2011": 27},
            None, None,
            {"2009": 100, "2010": 100, "2011": 100},
            {"2009": 10, "2010": 20, "2011": 30},
            {"2009": 30, "2010": 60, "2011": 90},
            None, None,
            {"2009": 100, "2010": 100, "2011": 100},
            {"2009": 3, "2010": 6, "2011": 9},
            {"2009": 9, "2010": 18, "2011": 27},
            None, None,
            {"2009": 1000, "2010": 1000, "2011": 1000},
            {"2009": 10, "2010": 40, "2011": 60},
            {"2009": 30, "2010": 240, "2011": 90},
            {"2009": 2000, "2010": 2000, "2011": 2000},
            {"2009": 3, "2010": 12, "2011": 18},
            {"2009": 9, "2010": 72, "2011": 27},
            {"2009": 1000, "2010": 1000, "2011": 1000},
            {"2009": 10, "2010": 40, "2011": 60},
            {"2009": 30, "2010": 240, "2011": 90},
            {"2009": 2000, "2010": 2000, "2011": 2000},
            {"2009": 3, "2010": 12, "2011": 18},
            {"2009": 9, "2010": 72, "2011": 27},
            {"2009": 0, "2010": 0, "2011": 0},
            {"2009": 0, "2010": 0, "2011": 0},
            {"2009": 0, "2010": 0, "2011": 0},
            {"2009": 0, "2010": 0, "2011": 0},
            {"2009": 0, "2010": 0, "2011": 0},
            {"2009": 0, "2010": 0, "2011": 0},
            {"2009": 0, "2010": 0, "2011": 0},
            {"2009": 1, "2010": 1, "2011": 1},
            1]],
            [[
             {"2009": 100, "2010": 100, "2011": 100},
             {"2009": 10, "2010": 20, "2011": 30},
             {"2009": 30, "2010": 60, "2011": 90},
             None, None,
             {"2009": 100, "2010": 100, "2011": 100},
             {"2009": 3, "2010": 6, "2011": 9},
             {"2009": 9, "2010": 18, "2011": 27}, None,
             None, None,
             {"2009": 100, "2010": 0, "2011": 0},
             {"2009": 10, "2010": 0, "2011": 0},
             {"2009": 30, "2010": 0, "2011": 0},
             None, None,
             {"2009": 100, "2010": 0, "2011": 0},
             {"2009": 3, "2010": 0, "2011": 0},
             {"2009": 9, "2010": 0, "2011": 0},
             None, None,
             {"2009": 1000, "2010": 1000, "2011": 1000},
             {"2009": 10, "2010": 40, "2011": 60},
             {"2009": 30, "2010": 240, "2011": 90},
             {"2009": 2000, "2010": 2000, "2011": 2000},
             {"2009": 3, "2010": 12, "2011": 18},
             {"2009": 9, "2010": 72, "2011": 27},
             {"2009": 1000, "2010": 0, "2011": 0},
             {"2009": 10, "2010": 0, "2011": 0},
             {"2009": 30, "2010": 0, "2011": 0},
             {"2009": 2000, "2010": 0, "2011": 0},
             {"2009": 3, "2010": 0, "2011": 0},
             {"2009": 9, "2010": 0, "2011": 0},
             {"2009": 0, "2010": 0, "2011": 0},
             {"2009": 0, "2010": 0, "2011": 0},
             {"2009": 0, "2010": 0, "2011": 0},
             {"2009": 0, "2010": 0, "2011": 0},
             {"2009": 0, "2010": 0, "2011": 0},
             {"2009": 0, "2010": 0, "2011": 0},
             {"2009": 0, "2010": 0, "2011": 0},
             {"2009": 1, "2010": 1, "2011": 1},
             1],
             [
             {"2009": 100, "2010": 100, "2011": 100},
             {"2009": 10, "2010": 20, "2011": 30},
             {"2009": 30, "2010": 60, "2011": 90},
             None, None,
             {"2009": 12, "2010": 24, "2011": 36},
             {"2009": 9.16, "2010": 16.64, "2011": 22.44},
             {"2009": 27.48, "2010": 49.92, "2011": 67.32},
             None, None,
             {"2009": 12, "2010": 12, "2011": 12},
             {"2009": 1.2, "2010": 2.4, "2011": 3.6},
             {"2009": 3.6, "2010": 7.2, "2011": 10.8},
             None, None,
             {"2009": 12, "2010": 12, "2011": 12},
             {"2009": 0.36, "2010": 0.72, "2011": 1.08},
             {"2009": 1.08, "2010": 2.16, "2011": 3.24},
             None, None,
             {"2009": 120, "2010": 240, "2011": 360},
             {"2009": 10, "2010": 40, "2011": 60},
             {"2009": 30, "2010": 240, "2011": 90},
             {"2009": 240, "2010": 480, "2011": 720},
             {"2009": 9.16, "2010": 33.28, "2011": 44.88},
             {"2009": 27.48, "2010": 199.68, "2011": 67.32},
             {"2009": 120, "2010": 120, "2011": 120},
             {"2009": 1.2, "2010": 4.8, "2011": 7.2},
             {"2009": 3.6, "2010": 28.8, "2011": 10.8},
             {"2009": 240, "2010": 240, "2011": 240},
             {"2009": 0.36, "2010": 1.44, "2011": 2.16},
             {"2009": 1.08, "2010": 8.64, "2011": 3.24},
             {"2009": 0, "2010": 0, "2011": 0},
             {"2009": 0, "2010": 0, "2011": 0},
             {"2009": 0, "2010": 0, "2011": 0},
             {"2009": 0, "2010": 0, "2011": 0},
             {"2009": 0, "2010": 0, "2011": 0},
             {"2009": 0, "2010": 0, "2011": 0},
             {"2009": 0, "2010": 0, "2011": 0},
             {"2009": 1, "2010": 1, "2011": 1},
             1]]]


    return {
        "time_horizons": time_horizons,
        "handyfiles": handyfiles,
        "handyvars": handyvars,
        "opts": opts,
        "measure_instance_fraction": measure_instance_fraction,
        "measure_instance_bass": measure_instance_bass,
        "measure_instance_fraction_string": measure_instance_fraction_string,
        "measure_instance_bass_string": measure_instance_bass_string,
        "measure_instance_bad_string": measure_instance_bad_string,
        "measure_instance_bad_values": measure_instance_bad_values,
        "measure_instance_wrong_name": measure_instance_wrong_name,
        "ok_diffuse_params_in": ok_diffuse_params_in,
        "ok_mskeys_in": ok_mskeys_in,
        "ok_mskeys_swtch_in": ok_mskeys_swtch_in,
        "ok_bldg_sect_in": ok_bldg_sect_in,
        "ok_sqft_subst_in": ok_sqft_subst_in,
        "ok_mkt_scale_frac_in": ok_mkt_scale_frac_in,
        "ok_new_bldg_constr": ok_new_bldg_constr,
        "ok_stock_in": ok_stock_in,
        "ok_energy_scnd_in": ok_energy_scnd_in,
        "ok_energy_in": ok_energy_in,
        "ok_carb_in": ok_carb_in,
        "ok_fcarb_in": ok_fcarb_in,
        "ok_f_refr_in": ok_f_refr_in,
        "ok_base_cost_in": ok_base_cost_in,
        "ok_cost_meas_in": ok_cost_meas_in,
        "ok_cost_energy_base_in": ok_cost_energy_base_in,
        "ok_cost_energy_meas_in": ok_cost_energy_meas_in,
        "ok_relperf_in": ok_relperf_in,
        "ok_life_base_in": ok_life_base_in,
        "ok_life_meas_in": ok_life_meas_in,
        "ok_ssconv_base_in": ok_ssconv_base_in,
        "ok_ssconv_meas_in": ok_ssconv_meas_in,
        "ok_carbint_base_in": ok_carbint_base_in,
        "ok_carbint_meas_in": ok_carbint_meas_in,
        "ok_tsv_scale_fracs_in": ok_tsv_scale_fracs_in,
        "ok_tsv_shapes_in": ok_tsv_shapes_in,
        "ok_out_fraction": ok_out_fraction,
        "ok_out_bass": ok_out_bass,
        "ok_out_fraction_string": ok_out_fraction_string,
        "ok_out_bass_string": ok_out_bass_string,
        "ok_out_bad_string": ok_out_bad_string,
        "ok_out_bad_values": ok_out_bad_values,
        "ok_out_wrong_name": ok_out_wrong_name,
        "ok_out": ok_out,
    }


def test_ok(test_data):
    """Test the 'partition_microsegment' function given valid inputs.

    Raises:
        AssertionError: If function yields unexpected results.
    """
    # Loop through 'ok_out' elements
    # Reset AEO time horizon and market entry/exit years
    test_data["measure_instance_fraction"].handyvars.aeo_years = \
        test_data["time_horizons"]
    test_data["measure_instance_fraction"].market_entry_year = \
        int(test_data["time_horizons"][0])
    test_data["measure_instance_fraction"].market_exit_year = \
        int(test_data["time_horizons"][-1]) + 1
    # Reset AEO time horizon and market entry/exit years
    test_data["measure_instance_bass"].handyvars.aeo_years = \
        test_data["time_horizons"]
    test_data["measure_instance_bass"].market_entry_year = \
        int(test_data["time_horizons"][0])
    test_data["measure_instance_bass"].market_exit_year = \
        int(test_data["time_horizons"][-1]) + 1
    # Reset AEO time horizon and market entry/exit years
    test_data["measure_instance_fraction_string"].handyvars.aeo_years = \
        test_data["time_horizons"]
    test_data["measure_instance_fraction_string"].market_entry_year = \
        int(test_data["time_horizons"][0])
    test_data["measure_instance_fraction_string"].market_exit_year = \
        int(test_data["time_horizons"][-1]) + 1
    # Reset AEO time horizon and market entry/exit years
    test_data["measure_instance_bass_string"].handyvars.aeo_years = \
        test_data["time_horizons"]
    test_data["measure_instance_bass_string"].market_entry_year = \
        int(test_data["time_horizons"][0])
    test_data["measure_instance_bass_string"].market_exit_year = \
        int(test_data["time_horizons"][-1]) + 1

    # Set measure-specific retrofit rate to test
    meas_retro_rate_fraction = test_data["measure_instance_fraction"].retro_rate
    meas_retro_rate_bass = test_data["measure_instance_bass"].retro_rate
    meas_retro_rate_fraction_string = test_data[
        "measure_instance_fraction_string"].retro_rate
    meas_retro_rate_bass_string = test_data[
        "measure_instance_bass_string"].retro_rate

    warnings_check = \
        [['WARNING: Not enough data were provided for first and last years'
          ' of the considered simulation period.\n\tThe simulation will '
          'continue assuming plausible diffusion fraction values.',
          'WARNING: Not enough data were provided for first and last '
          'years of the considered simulation period.\n\tThe simulation '
          'will continue assuming plausible diffusion fraction values.',
          'WARNING: Not enough data were provided for first and last years'
          ' of the considered simulation period.\n\tThe simulation will '
          'continue assuming plausible diffusion fraction values.',
          'WARNING: Not enough data were provided for first and last years'
          ' of the considered simulation period.\n\tThe simulation will '
          'continue assuming plausible diffusion fraction values.'],
         ['WARNING: Not enough data were provided for first and last '
          'years of the considered simulation period.\n\tThe simulation'
          ' will continue assuming plausible diffusion fraction values.',
          'WARNING: Not enough data were provided for first and last years'
          ' of the considered simulation period.\n\tThe simulation will '
          'continue assuming plausible diffusion fraction values.',
          'WARNING: Not enough data were provided for first and last '
          'years of the considered simulation period.\n\tThe simulation'
          ' will continue assuming plausible diffusion fraction values.',
          'WARNING: Not enough data were provided for first and last years'
          ' of the considered simulation period.\n\tThe simulation will '
          'continue assuming plausible diffusion fraction values.'],
         ['WARNING: Not enough data were provided for first and last'
          ' years of the considered simulation period.\n\tThe simulation'
          ' will continue assuming plausible diffusion fraction values.',
          'WARNING: Not enough data were provided for first and last '
          'years of the considered simulation period.\n\tThe simulation'
          ' will continue assuming plausible diffusion fraction values.',
          'WARNING: Not enough data were provided for first and last years'
          ' of the considered simulation period.\n\tThe simulation will '
          'continue assuming plausible diffusion fraction values.',
          'WARNING: Not enough data were provided for first and last'
          ' years of the considered simulation period.\n\tThe simulation'
          ' will continue assuming plausible diffusion fraction values.'],
         ['WARNING: Not enough data were provided for first and last'
          ' years of the considered simulation period.\n\tThe simulation'
          ' will continue assuming plausible diffusion fraction values.',
          'WARNING: Not enough data were provided for first and last years'
          ' of the considered simulation period.\n\tThe simulation will '
          'continue assuming plausible diffusion fraction values.',
          'WARNING: Not enough data were provided for first and last years'
          ' of the considered simulation period.\n\tThe simulation will '
          'continue assuming plausible diffusion fraction values.',
          'WARNING: Not enough data were provided for first and last years'
          ' of the considered simulation period.\n\tThe simulation will '
          'continue assuming plausible diffusion fraction values.']]

    warn_list = []
    warnings_fraction_measure = []
    warnings_bass_measure = []
    warnings_fraction_string_measure = []
    warnings_bass_string_measure = []

    # Loop through two test schemes (Technical potential and Max
    # adoption potential)
    for scn in range(0, len(test_data["handyvars"].adopt_schemes_prep)):
        # Loop through two microsegment key chains (one applying
        # to new structure type, another to existing structure type)
        for k in range(0, len(test_data["ok_mskeys_in"])):
            # List of output dicts generated by the function
            lists_fraction = test_data["measure_instance_fraction"].\
                          partition_microsegment(
                            test_data["handyvars"].adopt_schemes_prep[scn],
                            test_data["ok_diffuse_params_in"],
                            test_data["ok_mskeys_in"][k],
                            test_data["ok_mskeys_swtch_in"],
                            test_data["ok_bldg_sect_in"][k],
                            test_data["ok_sqft_subst_in"][k],
                            test_data["ok_mkt_scale_frac_in"],
                            test_data["ok_new_bldg_constr"],
                            test_data["ok_stock_in"],
                            test_data["ok_energy_in"],
                            test_data["ok_carb_in"],
                            test_data["ok_fcarb_in"],
                            test_data["ok_f_refr_in"],
                            test_data["ok_base_cost_in"],
                            test_data["ok_cost_meas_in"],
                            test_data["ok_cost_energy_base_in"],
                            test_data["ok_cost_energy_meas_in"],
                            test_data["ok_relperf_in"],
                            test_data["ok_life_base_in"],
                            test_data["ok_life_meas_in"],
                            test_data["ok_ssconv_base_in"],
                            test_data["ok_ssconv_meas_in"],
                            test_data["ok_carbint_base_in"],
                            test_data["ok_carbint_meas_in"],
                            test_data["ok_energy_scnd_in"],
                            test_data["ok_tsv_scale_fracs_in"],
                            test_data["ok_tsv_shapes_in"],
                            test_data["opts"], contrib_mseg_key="",
                            ctrb_ms_pkg_prep=[],
                            hp_rate=None,
                            retro_rate_mseg=meas_retro_rate_fraction,
                            calc_sect_shapes="", lkg_fmeth_base=None,
                            lkg_fmeth_meas=None, warn_list=warn_list)
            warnings_fraction_measure.append(lists_fraction[-1])

            lists_bass = test_data["measure_instance_bass"].partition_microsegment(
                                    test_data["handyvars"].adopt_schemes_prep[scn],
                                    test_data["ok_diffuse_params_in"],
                                    test_data["ok_mskeys_in"][k],
                                    test_data["ok_mskeys_swtch_in"],
                                    test_data["ok_bldg_sect_in"][k],
                                    test_data["ok_sqft_subst_in"][k],
                                    test_data["ok_mkt_scale_frac_in"],
                                    test_data["ok_new_bldg_constr"],
                                    test_data["ok_stock_in"],
                                    test_data["ok_energy_in"],
                                    test_data["ok_carb_in"],
                                    test_data["ok_fcarb_in"],
                                    test_data["ok_f_refr_in"],
                                    test_data["ok_base_cost_in"],
                                    test_data["ok_cost_meas_in"],
                                    test_data["ok_cost_energy_base_in"],
                                    test_data["ok_cost_energy_meas_in"],
                                    test_data["ok_relperf_in"],
                                    test_data["ok_life_base_in"],
                                    test_data["ok_life_meas_in"],
                                    test_data["ok_ssconv_base_in"],
                                    test_data["ok_ssconv_meas_in"],
                                    test_data["ok_carbint_base_in"],
                                    test_data["ok_carbint_meas_in"],
                                    test_data["ok_energy_scnd_in"],
                                    test_data["ok_tsv_scale_fracs_in"],
                                    test_data["ok_tsv_shapes_in"],
                                    test_data["opts"], contrib_mseg_key="",
                                    ctrb_ms_pkg_prep=[],
                                    hp_rate=None,
                                    retro_rate_mseg=meas_retro_rate_bass,
                                    calc_sect_shapes="",
                                    lkg_fmeth_base=None,
                                    lkg_fmeth_meas=None,
                                    warn_list=warn_list)
            warnings_bass_measure.append(lists_bass[-1])

            lists_fraction_string = test_data["measure_instance_fraction_string"].\
                partition_microsegment(
                        test_data["handyvars"].adopt_schemes_prep[scn],
                        test_data["ok_diffuse_params_in"],
                        test_data["ok_mskeys_in"][k],
                        test_data["ok_mskeys_swtch_in"],
                        test_data["ok_bldg_sect_in"][k],
                        test_data["ok_sqft_subst_in"][k],
                        test_data["ok_mkt_scale_frac_in"],
                        test_data["ok_new_bldg_constr"],
                        test_data["ok_stock_in"],
                        test_data["ok_energy_in"],
                        test_data["ok_carb_in"],
                        test_data["ok_fcarb_in"],
                        test_data["ok_f_refr_in"],
                        test_data["ok_base_cost_in"],
                        test_data["ok_cost_meas_in"],
                        test_data["ok_cost_energy_base_in"],
                        test_data["ok_cost_energy_meas_in"],
                        test_data["ok_relperf_in"],
                        test_data["ok_life_base_in"],
                        test_data["ok_life_meas_in"],
                        test_data["ok_ssconv_base_in"],
                        test_data["ok_ssconv_meas_in"],
                        test_data["ok_carbint_base_in"],
                        test_data["ok_carbint_meas_in"],
                        test_data["ok_energy_scnd_in"],
                        test_data["ok_tsv_scale_fracs_in"],
                        test_data["ok_tsv_shapes_in"],
                        test_data["opts"], contrib_mseg_key="",
                        ctrb_ms_pkg_prep=[],
                        hp_rate=None,
                        retro_rate_mseg=meas_retro_rate_fraction_string,
                        calc_sect_shapes="", lkg_fmeth_base=None,
                        lkg_fmeth_meas=None, warn_list=warn_list)
            warnings_fraction_string_measure.\
                append(lists_fraction_string[-1])

            lists_bass_string = test_data["measure_instance_bass_string"].\
                partition_microsegment(
                            test_data["handyvars"].adopt_schemes_prep[scn],
                            test_data["ok_diffuse_params_in"],
                            test_data["ok_mskeys_in"][k],
                            test_data["ok_mskeys_swtch_in"],
                            test_data["ok_bldg_sect_in"][k],
                            test_data["ok_sqft_subst_in"][k],
                            test_data["ok_mkt_scale_frac_in"],
                            test_data["ok_new_bldg_constr"],
                            test_data["ok_stock_in"], test_data["ok_energy_in"],
                            test_data["ok_carb_in"],
                            test_data["ok_fcarb_in"],
                            test_data["ok_f_refr_in"],
                            test_data["ok_base_cost_in"],
                            test_data["ok_cost_meas_in"],
                            test_data["ok_cost_energy_base_in"],
                            test_data["ok_cost_energy_meas_in"],
                            test_data["ok_relperf_in"],
                            test_data["ok_life_base_in"],
                            test_data["ok_life_meas_in"],
                            test_data["ok_ssconv_base_in"],
                            test_data["ok_ssconv_meas_in"],
                            test_data["ok_carbint_base_in"],
                            test_data["ok_carbint_meas_in"],
                            test_data["ok_energy_scnd_in"],
                            test_data["ok_tsv_scale_fracs_in"],
                            test_data["ok_tsv_shapes_in"],
                            test_data["opts"], contrib_mseg_key="",
                            ctrb_ms_pkg_prep=[],
                            hp_rate=None,
                            retro_rate_mseg=meas_retro_rate_bass_string,
                            calc_sect_shapes="", lkg_fmeth_base=None,
                            lkg_fmeth_meas=None, warn_list=warn_list)
            warnings_bass_string_measure.\
                append(lists_fraction_string[-1])

            # Correct list of output dicts
            lists_check_fraction = test_data["ok_out_fraction"][scn][k]
            # Compare each element of the lists of output dicts,
            # except for the warning messages
            for elem2 in range(0, len(lists_check_fraction)):
                # Handle possible NoneTypes or integers in the function output
                if lists_check_fraction[elem2] is not None and not isinstance(
                        lists_check_fraction[elem2], int):
                    dict_check(lists_check_fraction[elem2],
                                    lists_fraction[elem2])
                else:
                    assert lists_check_fraction[elem2] == lists_fraction[elem2]

            # Correct list of output dicts
            lists_check_bass = test_data["ok_out_bass"][scn][k]
            # Compare each element of the lists of output dicts
            for elem2 in range(0, len(lists_check_bass)):
                # Handle possible NoneTypes in the function output
                if lists_check_bass[elem2] is not None and not isinstance(
                        lists_check_bass[elem2], int):
                    dict_check(lists_check_bass[elem2],
                                    lists_bass[elem2])
                else:
                    assert lists_check_bass[elem2] == lists_bass[elem2]

            # Correct list of output dicts
            lists_check_fraction_string =\
                test_data["ok_out_fraction_string"][scn][k]
            # Compare each element of the lists of output dicts
            for elem2 in range(0, len(lists_check_fraction_string)):
                # Handle possible NoneTypes in the function output
                if lists_check_fraction_string[elem2] is not None and not isinstance(
                        lists_check_fraction_string[elem2], int):
                    dict_check(lists_check_fraction_string[elem2],
                                    lists_fraction_string[elem2])
                else:
                    assert lists_check_fraction_string[elem2] == lists_fraction_string[elem2]

            # Correct list of output dicts
            lists_check_bass_string = test_data["ok_out_bass_string"][scn][k]
            # Compare each element of the lists of output dicts
            for elem2 in range(0, len(lists_check_bass_string)):
                # Handle possible NoneTypes in the function output
                if lists_check_bass_string[elem2] is not None and not isinstance(
                        lists_check_bass_string[elem2], int):
                    dict_check(lists_check_bass_string[elem2],
                                    lists_bass_string[elem2])
                else:
                    assert lists_check_bass_string[elem2] == lists_bass_string[elem2]

    for elem2 in range(0, len(warnings_check)):
        assert warnings_fraction_measure[elem2] == warnings_check[elem2]

    for elem2 in range(0, len(warnings_check)):
        assert warnings_bass_measure[elem2] == warnings_check[elem2]

    for elem2 in range(0, len(warnings_check)):
        assert warnings_fraction_string_measure[elem2] == warnings_check[elem2]

    for elem2 in range(0, len(warnings_check)):
        assert warnings_bass_string_measure[elem2] == warnings_check[elem2]


def test_overrides(test_data):

    """Test the 'partition_microsegment' function given valid inputs.

    Raises:
       AssertionError: If function yields unexpected results.
    """
    # Loop through 'ok_out' elements

    # Reset AEO time horizon and market entry/exit years
    test_data["measure_instance_bad_string"].handyvars.aeo_years = \
        test_data["time_horizons"]
    test_data["measure_instance_bad_string"].market_entry_year = \
        int(test_data["time_horizons"][0])
    test_data["measure_instance_bad_string"].market_exit_year = \
        int(test_data["time_horizons"][-1]) + 1
    # Reset AEO time horizon and market entry/exit years
    test_data["measure_instance_bad_values"].handyvars.aeo_years = \
        test_data["time_horizons"]
    test_data["measure_instance_bad_values"].market_entry_year = \
        int(test_data["time_horizons"][0])
    test_data["measure_instance_bad_values"].market_exit_year = \
        int(test_data["time_horizons"][-1]) + 1
    # Reset AEO time horizon and market entry/exit years
    test_data["measure_instance_wrong_name"].handyvars.aeo_years = \
        test_data["time_horizons"]
    test_data["measure_instance_wrong_name"].market_entry_year = \
        int(test_data["time_horizons"][0])
    test_data["measure_instance_wrong_name"].market_exit_year = \
        int(test_data["time_horizons"][-1]) + 1

    # Set measure-specific retrofit rate to test
    meas_retro_rate_bad_string = test_data[
        "measure_instance_bad_string"].retro_rate
    meas_retro_rate_bad_values = test_data[
        "measure_instance_bad_values"].retro_rate
    meas_retro_rate_instance_wrong_name = test_data[
        "measure_instance_wrong_name"].retro_rate

    warnings_check = \
        ['WARNING: Diffusion parameters are not properly '
         'defined in the measure\n==>diffusion parameters set'
         ' to 1 for every year.', 'WARNING: Some declared '
         'diffusion fractions are greater than 1. Their value '
         'has been changed to 1.', 'WARNING: Some declared '
         'diffusion fractions are smaller than 0. Their value'
         ' has been changed to 0.', 'WARNING: Not enough data were'
         ' provided for first and last years of the considered '
         'simulation period.\n\tThe simulation will continue assuming'
         ' plausible diffusion fraction values.',
         'WARNING: Diffusion parameters are not properly '
         'defined in the measure\n==>diffusion parameters set'
         ' to 1 for every year.', 'WARNING: Some declared '
         'diffusion fractions are greater than 1. Their value '
         'has been changed to 1.', 'WARNING: Some declared '
         'diffusion fractions are smaller than 0. Their value'
         ' has been changed to 0.', 'WARNING: Not enough data were'
         ' provided for first and last years of the considered '
         'simulation period.\n\tThe simulation will continue assuming'
         ' plausible diffusion fraction values.',
         'WARNING: Diffusion parameters are not properly '
         'defined in the measure\n==>diffusion parameters set'
         ' to 1 for every year.', 'WARNING: Some declared '
         'diffusion fractions are greater than 1. Their value '
         'has been changed to 1.', 'WARNING: Some declared '
         'diffusion fractions are smaller than 0. Their value'
         ' has been changed to 0.', 'WARNING: Not enough data were'
         ' provided for first and last years of the considered '
         'simulation period.\n\tThe simulation will continue assuming'
         ' plausible diffusion fraction values.',
         'WARNING: Diffusion parameters are not properly '
         'defined in the measure\n==>diffusion parameters set'
         ' to 1 for every year.', 'WARNING: Some declared '
         'diffusion fractions are greater than 1. Their value '
         'has been changed to 1.', 'WARNING: Some declared '
         'diffusion fractions are smaller than 0. Their value'
         ' has been changed to 0.', 'WARNING: Not enough data were'
         ' provided for first and last years of the considered '
         'simulation period.\n\tThe simulation will continue assuming'
         ' plausible diffusion fraction values.']

    warn_list = []
    warnings_bad_string_measure = []
    warnings_bad_values_measure = []
    warnings_wrong_name_measure = []

    # Loop through two test schemes (Technical potential and Max
    # adoption potential)
    for scn in range(0, len(test_data["handyvars"].adopt_schemes_prep)):
        # Loop through two microsegment key chains (one applying
        # to new structure type, another to existing structure type)
        for k in range(0, len(test_data["ok_mskeys_in"])):
            # List of output dicts generated by the function
            lists_bad_string = test_data["measure_instance_bad_string"].\
                partition_microsegment(
                           test_data["handyvars"].adopt_schemes_prep[scn],
                           test_data["ok_diffuse_params_in"],
                           test_data["ok_mskeys_in"][k],
                           test_data["ok_mskeys_swtch_in"],
                           test_data["ok_bldg_sect_in"][k],
                           test_data["ok_sqft_subst_in"][k],
                           test_data["ok_mkt_scale_frac_in"],
                           test_data["ok_new_bldg_constr"],
                           test_data["ok_stock_in"],
                           test_data["ok_energy_in"],
                           test_data["ok_carb_in"],
                           test_data["ok_fcarb_in"],
                           test_data["ok_f_refr_in"],
                           test_data["ok_base_cost_in"],
                           test_data["ok_cost_meas_in"],
                           test_data["ok_cost_energy_base_in"],
                           test_data["ok_cost_energy_meas_in"],
                           test_data["ok_relperf_in"],
                           test_data["ok_life_base_in"],
                           test_data["ok_life_meas_in"],
                           test_data["ok_ssconv_base_in"],
                           test_data["ok_ssconv_meas_in"],
                           test_data["ok_carbint_base_in"],
                           test_data["ok_carbint_meas_in"],
                           test_data["ok_energy_scnd_in"],
                           test_data["ok_tsv_scale_fracs_in"],
                           test_data["ok_tsv_shapes_in"],
                           test_data["opts"], contrib_mseg_key="",
                           ctrb_ms_pkg_prep=[],
                           hp_rate=None,
                           retro_rate_mseg=meas_retro_rate_bad_string,
                           calc_sect_shapes="", lkg_fmeth_base=None,
                           lkg_fmeth_meas=None, warn_list=warn_list)
            warnings_bad_string_measure.append(lists_bad_string[-1])

            lists_bad_values = test_data["measure_instance_bad_values"].\
                partition_microsegment(
                               test_data["handyvars"].adopt_schemes_prep[scn],
                               test_data["ok_diffuse_params_in"],
                               test_data["ok_mskeys_in"][k],
                               test_data["ok_mskeys_swtch_in"],
                               test_data["ok_bldg_sect_in"][k],
                               test_data["ok_sqft_subst_in"][k],
                               test_data["ok_mkt_scale_frac_in"],
                               test_data["ok_new_bldg_constr"],
                               test_data["ok_stock_in"],
                               test_data["ok_energy_in"],
                               test_data["ok_carb_in"],
                               test_data["ok_fcarb_in"],
                               test_data["ok_f_refr_in"],
                               test_data["ok_base_cost_in"],
                               test_data["ok_cost_meas_in"],
                               test_data["ok_cost_energy_base_in"],
                               test_data["ok_cost_energy_meas_in"],
                               test_data["ok_relperf_in"],
                               test_data["ok_life_base_in"],
                               test_data["ok_life_meas_in"],
                               test_data["ok_ssconv_base_in"],
                               test_data["ok_ssconv_meas_in"],
                               test_data["ok_carbint_base_in"],
                               test_data["ok_carbint_meas_in"],
                               test_data["ok_energy_scnd_in"],
                               test_data["ok_tsv_scale_fracs_in"],
                               test_data["ok_tsv_shapes_in"],
                               test_data["opts"], contrib_mseg_key="",
                               ctrb_ms_pkg_prep=[],
                               hp_rate=None,
                               retro_rate_mseg=meas_retro_rate_bad_values,
                               calc_sect_shapes="", lkg_fmeth_base=None,
                               lkg_fmeth_meas=None, warn_list=warn_list)
            warnings_bad_values_measure.append(lists_bad_values[-1])

            lists_wrong_name = test_data["measure_instance_wrong_name"].\
                partition_microsegment(
                       test_data["handyvars"].adopt_schemes_prep[scn],
                       test_data["ok_diffuse_params_in"],
                       test_data["ok_mskeys_in"][k],
                       test_data["ok_mskeys_swtch_in"],
                       test_data["ok_bldg_sect_in"][k],
                       test_data["ok_sqft_subst_in"][k],
                       test_data["ok_mkt_scale_frac_in"],
                       test_data["ok_new_bldg_constr"],
                       test_data["ok_stock_in"], test_data["ok_energy_in"],
                       test_data["ok_carb_in"],
                       test_data["ok_fcarb_in"],
                       test_data["ok_f_refr_in"],
                       test_data["ok_base_cost_in"], test_data["ok_cost_meas_in"],
                       test_data["ok_cost_energy_base_in"],
                       test_data["ok_cost_energy_meas_in"],
                       test_data["ok_relperf_in"],
                       test_data["ok_life_base_in"],
                       test_data["ok_life_meas_in"],
                       test_data["ok_ssconv_base_in"],
                       test_data["ok_ssconv_meas_in"],
                       test_data["ok_carbint_base_in"],
                       test_data["ok_carbint_meas_in"],
                       test_data["ok_energy_scnd_in"],
                       test_data["ok_tsv_scale_fracs_in"],
                       test_data["ok_tsv_shapes_in"],
                       test_data["opts"], contrib_mseg_key="",
                       ctrb_ms_pkg_prep=[],
                       hp_rate=None,
                       retro_rate_mseg=meas_retro_rate_instance_wrong_name,
                       calc_sect_shapes="", lkg_fmeth_base=None,
                       lkg_fmeth_meas=None, warn_list=warn_list)
            warnings_wrong_name_measure.append(lists_wrong_name[-1])

            # Correct list of output dicts
            lists_check_bad_string = test_data["ok_out_bad_string"][scn][k]
            # Compare each element of the lists of output dicts
            for elem2 in range(0, len(lists_check_bad_string)):
                # Handle possible NoneTypes in the function output
                if lists_check_bad_string[elem2] is not None and not isinstance(
                        lists_check_bad_string[elem2], int):
                    dict_check(lists_check_bad_string[elem2],
                                    lists_bad_string[elem2])
                else:
                    assert lists_check_bad_string[elem2] == lists_bad_string[elem2]

            # Correct list of output dicts
            lists_check_bad_values = test_data["ok_out_bad_values"][scn][k]
            # Compare each element of the lists of output dicts
            for elem2 in range(0, len(lists_check_bad_values)):
                # Handle possible NoneTypes in the function output
                if lists_check_bad_values[elem2] is not None and not isinstance(
                        lists_check_bad_values[elem2], int):
                    dict_check(lists_check_bad_values[elem2],
                                    lists_bad_values[elem2])
                else:
                    assert lists_check_bad_values[elem2] == lists_bad_values[elem2]

            # Correct list of output dicts
            lists_check_wrong_name = test_data["ok_out_wrong_name"][scn][k]
            # Compare each element of the lists of output dicts
            for elem2 in range(0, len(lists_check_wrong_name)):
                # Handle possible NoneTypes in the function output
                if lists_check_wrong_name[elem2] is not None and not isinstance(
                        lists_check_wrong_name[elem2], int):
                    dict_check(lists_check_wrong_name[elem2],
                                    lists_wrong_name[elem2])
                else:
                    assert lists_check_wrong_name[elem2] == lists_wrong_name[elem2]

    for elem2 in range(0, len(warnings_bad_string_measure)):
        assert warnings_bad_string_measure[elem2] == warnings_check

    for elem2 in range(0, len(warnings_bad_values_measure)):
        assert warnings_bad_values_measure[elem2] == warnings_check

    for elem2 in range(0, len(warnings_wrong_name_measure)):
        assert warnings_wrong_name_measure[elem2] == warnings_check



