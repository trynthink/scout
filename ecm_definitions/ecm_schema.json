{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Building Energy Efficiency Measure",
  "type": "object",
   "required": [
    "name",
    "_description",
    "measure_type",
    "climate_zone",
    "bldg_type",
    "structure_type",
    "end_use",
    "fuel_type",
    "technology",
    "energy_efficiency",
    "energy_efficiency_units",
    "installed_cost",
    "cost_units",
    "product_lifetime",
    "product_lifetime_units"
  ],
  "definitions": {
    "climateZoneEnum": {
      "type": "string",
      "enum": [
        "all", "warm climates", "cold climates", 
        "TRE", "FRCC", "MISW", "MISC", "MISE", "MISS", "ISNE", "NYCW", "NYUP", "PJME", "PJMW", "PJMC", "PJMD",
        "SRCA", "SRSE", "SRCE", "SPPS", "SPPC", "SPPN", "SRSG", "CANO", "CASO", "NWPP", "RMRG", "BASN",
        "AIA_CZ1", "AIA_CZ2", "AIA_CZ3", "AIA_CZ4", "AIA_CZ5",
        "AL", "AZ", "AR", "CA", "CO", "CT", "DE", "DC", "FL", "GA", "ID", "IL", "IN", "IA", "KS", "KY", "LA", 
        "ME", "MD", "MA", "MI", "MN", "MS", "MO", "MT", "NE", "NV", "NH", "NJ", "NM", "NY", "NC", "ND", "OH", 
        "OK", "OR", "PA", "RI", "SC", "SD", "TN", "TX", "UT", "VT", "VA", "WA", "WV", "WI", "WY"
      ]
    },
    "bldgTypeEnum": {
      "type": "string",
      "enum": [
        "all",
        "all residential", "single family home", "multi family home", "mobile home",
        "all commercial", "assembly", "education", "food sales", "food service", "health care", 
        "lodging", "large office", "small office", "mercantile/service", "warehouse", 
        "other", "unspecified"
      ]
    },
    "endUseEnum": {
      "type": "string",
      "enum": [
        "all", "heating", "secondary heating", "cooling", "water heating", "cooking", 
        "drying", "lighting", "refrigeration", "ceiling fan", "fans and pumps", "computers", 
        "TVs", "ventilation", "PCs", "non-PC office equipment", "MELs", "unspecified", "other"
      ]
    },
    "technologyEnum": {
      "type": "string",
      "enum": [
        "all",  "ASHP", "GSHP", "resistance heat", "NGHP", "boiler (NG)", "furnace (NG)",
        "boiler (distillate)", "furnace (distillate)", "furnace (LPG)", "furnace (kerosene)", "stove (wood)",
        "secondary heater", "secondary heater (wood)", "secondary heater (coal)", "secondary heater (kerosene)", 
        "secondary heater (LPG)", "room AC", "central AC", "electric WH", "solar WH",
        "general service (incandescent)", "reflector (incandescent)", "reflector (halogen)", "external (incandescent)",
        "external (high pressure sodium)", "general service (CFL)", "reflector (CFL)", "linear fluorescent (T-8)",
        "linear fluorescent (T-12)", "external (CFL)", "general service (LED)", "reflector (LED)", 
        "linear fluorescent (LED)", "external (LED)", "desktop PC", "laptop PC", "network equipment", "monitors",
        "home theater and audio", "set top box", "video game consoles", "OTT streaming devices", "TV",
        "dishwasher", "clothes washing", "freezers", "rechargeables", "coffee maker", "dehumidifier", "electric other", 
        "small kitchen appliances", "microwave", "smartphones", "pool heaters", "pool pumps", "security system", 
        "portable electric spas", "smart speakers", "tablets", "wine coolers", "other appliances", 
        "roof", "wall", "infiltration", "ground", "windows solar", "windows conduction", "equipment gain", "people gain",
        "electric_res-heat", "elec_res-heater", "comm_GSHP-heat", "rooftop_ASHP-heat", "elec_boiler", "pkg_terminal_HP-heat",
        "gas_eng-driven_RTHP-heat", "res_type_gasHP-heat", "gas_boiler", "gas_furnace", "oil_boiler", "oil_furnace",
        "rooftop_AC", "scroll_chiller", "res_type_central_AC", "reciprocating_chiller", "comm_GSHP-cool", 
        "centrifugal_chiller", "rooftop_ASHP-cool", "wall-window_room_AC", "screw_chiller", "pkg_terminal_AC-cool", 
        "pkg_terminal_HP-cool", "gas_eng-driven_RTAC", "gas_chiller", "res_type_gasHP-cool", "gas_eng-driven_RTHP-cool",
        "CAV_Vent", "VAV_Vent", "solar water heater", "solar_water_heater_north", "HP water heater", "elec_water_heater",
        "gas_water_heater", "gas_instantaneous_water_heater", "oil_water_heater", "100W A19 Incandescent", 
        "100W Equivalent A19 Halogen", "100W Equivalent CFL Bare Spiral", "100W Equivalent LED A Lamp", 
        "Halogen Infrared Reflector (HIR) PAR38", "Halogen PAR38", "LED PAR38", "T5 F28", "T8 F28", "T8 F32", "T8 F59", 
        "T8 F96", "T5 4xF54 HO High Bay", "Mercury Vapor", "Metal Halide", "Sodium Vapor", "LED Integrated Luminaire",
        "Commercial Beverage Merchandisers", "Commercial Ice Machines", "Commercial Reach-In Freezers", 
        "Commercial Reach-In Refrigerators", "Commercial Refrigerated Vending Machines", "Commercial Supermarket Display Cases", 
        "Commercial Walk-In Freezers", "Commercial Walk-In Refrigerators", "electric_range-combined", "gas_range-combined",
        "distribution transformers", "kitchen ventilation", "security systems", "lab fridges and freezers", "medical imaging", 
        "large video boards", "coffee brewers", "non-road electric vehicles", "fume hoods", "laundry", "elevators", 
        "escalators", "IT equipment", "office UPS", "data center UPS", "shredders", "private branch exchanges", 
        "voice-over-IP telecom", "point-of-sale systems", "warehouse robots", "televisions", "water services", "floor",
        "ventilation", "lighting gain", "other heat gain", "all ventilation"
      ]
    },
     "dayEnum": {
      "type": "integer",
      "minimum": 1,
      "maximum": 365
    },
    "energyEfficiencyType": {
      "type": ["number", "object"],
      "patternProperties": {
        "^.*$": { "$ref": "#/definitions/energyEfficiencyType" }
      }
    },
    "energyEfficiencyUnitsType": {
      "type": ["string", "object"],
      "patternProperties": {
        "^.*$": { "$ref": "#/definitions/energyEfficiencyUnitsType" }
      }
    },
    "marketScalingFractionsType": {
      "type": ["number", "object", "null"],
      "minimum": 0,
      "maximum": 1,
      "patternProperties": {
        "^.*$": { "$ref": "#/definitions/marketScalingFractionsType" }
      }
    },
    "sourceSchema": {
      "type": ["object", "null"],
      "properties": {
        "notes":  { 
          "type": ["string", "array", "null"],
          "items": { "type": "string" }
        },
        "source_data": {
          "type": ["string", "object", "array", "null"],
          "properties": {
              "title": { "type": "string" },
              "author": { "type": ["string", "null"] },
              "organization": { "type": "string" },
              "year": { "type": "integer" },
              "pages": {
                "type": ["integer", "string", "array", "null"],
                "items": { "type": "integer" }
              },
              "URL": { "type": "string", "format": "uri" }
            },
            "required": ["title", "year"],
          "items": {
            "type": "object",
            "properties": {
              "title": { "type": "string" },
              "author": { "type": ["string", "null"] },
              "organization": { "type": "string" },
              "year": { "type": "integer" },
              "pages": {
                "type": ["integer", "string", "array", "null"],
                "items": { "type": "integer" }
              },
              "URL": { "type": "string", "format": "uri" }
            },
            "required": ["title", "year"]
          }
        }
      }
    }
  },
  "properties": {
    "name": { "type": "string", "maxLength": 60 },
    "_description": { 
          "type": ["string", "array"],
          "items": { "type": "string" }
        },
    "_notes": { "type": "string" },
    "measure_type": { "type": "string" , "enum": ["full service", "add-on"]},
    "ref_analogue": { "type": "boolean" },
    "market_entry_year": { "type": ["integer", "null"] },
    "market_entry_year_source": { "$ref": "#/definitions/sourceSchema" },
    "market_exit_year": { "type": ["integer", "null"] },
    "market_exit_year_source": { "$ref": "#/definitions/sourceSchema" },
    "min_eff_elec_flag": { 
      "type": ["boolean", "string", "null"], 
      "enum": [true, false, "yes", "no", null]
    },
    "ref_case_flag": { 
      "type": ["boolean", "string", "null"], 
      "enum": [true, false, "yes", "no", null]
    },
    "climate_zone": {
      "oneOf": [
        { "$ref": "#/definitions/climateZoneEnum" },
        {
          "type": "array",
          "items": { "$ref": "#/definitions/climateZoneEnum" },
          "uniqueItems": true
        }
      ]
    },
    "bldg_type": {
      "oneOf": [
        { "$ref": "#/definitions/bldgTypeEnum" },
        {
          "type": "array",
          "items": { "$ref": "#/definitions/bldgTypeEnum" },
          "uniqueItems": true
        }
      ]
    },
    "structure_type": {
      "oneOf": [
        { "type": "string", 
        "enum": ["new", "existing", "all"] },
        {
          "type": "array",
          "items": {
            "type": "string", 
            "enum": ["new", "existing", "all"] },
          "uniqueItems": true
        }
      ]
    },
    "end_use": {
      "oneOf": [
        { "$ref": "#/definitions/endUseEnum" },
        {
          "type": "array",
          "items": { "$ref": "#/definitions/endUseEnum" },
          "uniqueItems": true
        }
      ]
    },
    "fuel_type": {
      "oneOf": [
        { "type": "string", 
        "enum": ["electricity", "natural gas", "distillate", "other fuel", "all"] },
        {
          "type": "array",
          "items": {
            "type": "string", 
            "enum": ["electricity", "natural gas", "distillate", "other fuel", "all"] },
          "uniqueItems": true
        }
      ]
    },
    "fuel_switch_to": { 
      "enum": ["electricity", "natural gas", "distillate", "other fuel", "all", null]
    },
    "backup_fuel_fraction": { "type": ["string", "null"] },
    "technology": { 
      "oneOf": [
        { "$ref": "#/definitions/technologyEnum" },
        {
          "type": "array",
          "items": { "$ref": "#/definitions/technologyEnum" },
          "uniqueItems": true
        }
      ]
    }, 
    "htcl_tech_link": { "type": ["string", "null"] },
    "tech_switch_to": { 
      "enum": ["ASHP", "GSHP", "HPWH","resistance heat", "Electric cooking", "induction", "Electric drying", 
      "HP dryer", "elec_water_heater", "elec_range-combined", "elec_boiler",
      "LED", "electric WH", "electric range", "electric dryer", "electric other", "same", null]
    },
    "energy_efficiency": {"$ref": "#/definitions/energyEfficiencyType"},
    "energy_efficiency_units": {"$ref": "#/definitions/energyEfficiencyUnitsType"},
    "energy_efficiency_source": { "$ref": "#/definitions/sourceSchema" },
    "installed_cost": {
      "type": ["number", "object"],
      "patternProperties": {
        ".*": {  
          "type": ["number", "object"],
          "patternProperties": {
            ".*": {  
              "type": ["number", "object"],
              "patternProperties": {
                ".*": { 
                  "type": "number"
                }
              }
            }
          }
        }
      }
    },
    "cost_units": {
      "type": ["string", "object"],
      "patternProperties": {
        ".*": {  
          "type": ["string", "object"],
          "patternProperties": {
            ".*": { 
              "type": ["string", "object"],
              "patternProperties": {
                ".*": { 
                  "type": "string"
                }
              }
            }
          }
        }
      }
    },
    "installed_cost_source": { "$ref": "#/definitions/sourceSchema" },
    "add_elec_infr_cost": { "type": ["object", "null"] }, 
    "product_lifetime": {
      "type": ["integer", "number", "object"],
      "minimum": 1,
      "patternProperties": {
        ".*": { 
          "type": "integer",
          "minimum": 1 
        }
      }
    },
    "product_lifetime_units": { "type": "string", "enum": ["years"] },
    "product_lifetime_source": { "$ref": "#/definitions/sourceSchema" },
    "tsv_features": { 
      "type": "object",
      "propertyNames": { "$ref": "#/definitions/climateZoneEnum" },
      "additionalProperties": {
        "type": "object",
        "propertyNames": { "$ref": "#/definitions/bldgTypeEnum" },
        "additionalProperties": {
          "type": "object",
          "propertyNames": { "$ref": "#/definitions/endUseEnum" },
          "additionalProperties": {
            "type": "object",
            "properties": {
                    "shed": { 
                      "type": "object",
                      "properties":{
                        "relative energy change fraction": {
                          "type": "number", 
                          "minimum": 0,
                          "maximum": 1
                        }, 
                        "start_hour": {
                          "type": "integer", 
                          "minimum": 1,
                          "maximum": 24
                        }, 
                        "stop_hour": {
                          "type": "integer", 
                          "minimum": 1,
                          "maximum": 24
                        }, 
                        "start_day": {
                          "oneOf": [
                            { "$ref": "#/definitions/dayEnum" },
                            {
                              "type": "array",
                              "items": { "$ref": "#/definitions/dayEnum" },
                              "uniqueItems": true
                            }
                          ]
                        }, 
                        "stop_day": {
                          "oneOf": [
                            { "$ref": "#/definitions/dayEnum" },
                            {
                              "type": "array",
                              "items": { "$ref": "#/definitions/dayEnum" },
                              "uniqueItems": true
                            }
                          ]
                        }
                      },
                      "required": ["relative energy change fraction", "start_hour", "stop_hour", "stop_day"]
                    },
                    "shift": { 
                      "type": "object",
                      "properties":{
                        "offset_hrs_earlier": {
                          "type": "integer", 
                          "minimum": 1,
                          "maximum": 24
                        },
                        "relative energy change fraction": {
                          "type": "number", 
                          "minimum": 0,
                          "maximum": 1
                        }, 
                        "start_hour": {
                          "type": "integer", 
                          "minimum": 1,
                          "maximum": 24
                        }, 
                        "stop_hour": {
                          "type": "integer", 
                          "minimum": 1,
                          "maximum": 24
                        }, 
                        "start_day": {
                          "oneOf": [
                            { "$ref": "#/definitions/dayEnum" },
                            {
                              "type": "array",
                              "items": { "$ref": "#/definitions/dayEnum" },
                              "uniqueItems": true
                            }
                          ]
                        }, 
                        "stop_day": {
                          "oneOf": [
                            { "$ref": "#/definitions/dayEnum" },
                            {
                              "type": "array",
                              "items": { "$ref": "#/definitions/dayEnum" },
                              "uniqueItems": true
                            }
                          ]
                        }
                      },
                      "required": ["offset_hrs_earlier", "relative energy change fraction", "start_hour", "stop_hour", "stop_day"]
                    },
                    "shape": { 
                      "type": "object",
                      "properties":{
                        "start_day": {
                          "oneOf": [
                            { "$ref": "#/definitions/dayEnum" },
                            {
                              "type": "array",
                              "items": { "$ref": "#/definitions/dayEnum" },
                              "uniqueItems": true
                            }
                          ]
                        }, 
                        "stop_day": {
                          "oneOf": [
                            { "$ref": "#/definitions/dayEnum" },
                            {
                              "type": "array",
                              "items": { "$ref": "#/definitions/dayEnum" },
                              "uniqueItems": true
                            }
                          ]
                        },
                        "custom_daily_savings":{
                          "type": "array",
                          "items": { 
                            "type": "number"
                          },
                          "minItems": 24,
                          "maxItems": 24
                        },
                        "custom_annual_savings":{
                          "type": "string"
                        }
                      },
                      "required": ["stop_day"]
                    }
            }
          }
        }
      }
    },
    "tsv_source": { 
      "type": "object",
      "propertyNames": { "$ref": "#/definitions/climateZoneEnum" },
      "additionalProperties": {
        "type": "object",
        "propertyNames": { "$ref": "#/definitions/bldgTypeEnum" },
        "additionalProperties": {
          "type": "object",
          "propertyNames": { "$ref": "#/definitions/endUseEnum" },
          "additionalProperties": {
            "type": "object",
            "properties": { "$ref": "#/definitions/sourceSchema" }
          }
        }
      }
    },
    "market_scaling_fractions": {"$ref": "#/definitions/marketScalingFractionsType"},
    "market_scaling_fractions_source":{
      "type": ["object", "null"],
      "properties": {
        "notes": { 
          "type": ["string", "array", "null"],
          "items": { "type": "string" }
        },
        "source_data": {
          "type": ["string", "object", "array", "null"],
          "properties": {
              "title": { "type": "string" },
              "author": { "type": ["string", "null"] },
              "organization": { "type": "string" },
              "year": { "type": "integer" },
              "pages": {
                "type": ["integer", "string", "array", "null"],
                "items": { "type": "integer" }
              },
              "URL": { "type": "string", "format": "uri" },
              "fraction_derivation": {"type": "string"}
            },
            "required": ["title", "year"],
          "items": {
            "type": "object",
            "properties": {
              "title": { "type": "string" },
              "author": { "type": ["string", "null"] },
              "organization": { "type": "string" },
              "year": { "type": "integer" },
              "pages": {
                "type": ["integer", "string", "array", "null"],
                "items": { "type": "integer" }
              },
              "URL": { "type": "string", "format": "uri" },
              "fraction_derivation": {"type": "string"}
            },
            "required": ["title", "year"]
          }
        }
      },
      "required": ["source_data"]
    },
    "retro_rate": {
      "type": ["number", "null"],
      "minimum": 0,
      "maximum": 1
    },
    "retro_rate_source": { "$ref": "#/definitions/sourceSchema" },
    "_added_by": {
      "type": "object",
      "properties": {
        "name": { "type": "string" },
        "organization": { "type": "string" },
        "email": { "type": "string", "format": "email" },
        "timestamp": { 
          "type": "string", 
          "pattern": "^\\d{4}-\\d{2}-\\d{2} \\d{2}:\\d{2}:\\d{2}$"
        }
      },
      "required": ["name", "organization", "email", "timestamp"]
    },
    "_updated_by": {
      "type": ["object", "null"],
      "properties": {
        "name": { "type": "string" },
        "organization": { "type": "string" },
        "email": { "type": "string", "format": "email" },
        "timestamp": { 
          "type": "string", 
          "pattern": "^\\d{4}-\\d{2}-\\d{2} \\d{2}:\\d{2}:\\d{2}$"
        }
      },
      "required": ["name", "organization", "email", "timestamp"]
    }
  }
}